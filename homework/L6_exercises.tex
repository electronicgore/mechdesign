%%% License: Creative Commons Attribution Share Alike 4.0 (see https://creativecommons.org/licenses/by-sa/4.0/)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[a4paper]{article}

\usepackage{amssymb}
\usepackage{enumitem}
\usepackage[usenames,dvipsnames]{color}
\usepackage{fancyhdr} % Required for custom headers
\usepackage{lastpage} % Required to determine the last page for the footer
\usepackage{extramarks} % Required for headers and footers
\usepackage[usenames,dvipsnames]{color} % Required for custom colors
\usepackage{graphicx} % Required to insert images
\usepackage{listings} % Required for insertion of code
\usepackage{courier} % Required for the courier font
\usepackage[table]{xcolor}
\usepackage{amsfonts,amsmath,amsthm,parskip,setspace,url}
\usepackage[section]{placeins}
\usepackage[a4paper]{geometry}
\usepackage[USenglish]{babel}
\usepackage[utf8]{inputenc}
\usepackage{tikz}


% Margins
\topmargin=-0.45in
\evensidemargin=0in
\oddsidemargin=0in
\textwidth=6.5in
\textheight=9.0in
\headsep=0.6in

\linespread{1.1} % Line spacing



%----------------------------------------------------------------------------------------
%   FORMATTING
%----------------------------------------------------------------------------------------
% Set up the header and footer
\pagestyle{fancy}
\lhead[c]{\textbf{{\color[rgb]{.5,0,0} K{\o}benhavns\\Universitet }}} % Top left header
\chead{\textbf{{\color[rgb]{.5,0,0} \Class }}\\ \hmwkTitle  } % Top center head
\rhead{\instructor \\ \theprofessor} % Top right header
\lfoot{\lastxmark} % Bottom left footer
\cfoot{} % Bottom center footer
\rfoot{Page\ \thepage\ of\ \protect\pageref{LastPage}} % Bottom right footer
\renewcommand\headrulewidth{0.4pt} % Size of the header rule
\renewcommand\footrulewidth{0.4pt} % Size of the footer rule


% Other formatting stuff
%\setlength\parindent{12pt}
\setlength{\parskip}{5 pt}
%\theoremstyle{definition} \newtheorem{ex}{\textbf{\Large{Exercise & #}\\}}
\usepackage{titlesec}
\titleformat{\section}[hang]{\normalfont\bfseries\Large}{Problem \thesection:}{0.5em}{}




%----------------------------------------------------------------------------------------
%	NAME AND CLASS SECTION
%----------------------------------------------------------------------------------------
\newcommand{\hmwkTitle}{Exercises for Lecture 6} % Assignment title
\newcommand{\Class}{Mechanism Design} % Course/class
\newcommand{\instructor}{Fall 2023} % TA
\newcommand{\theprofessor}{Prof. Egor Starkov} % Professor




%----------------------------------------------------------------------------------------
%   SOLUTIONS
%----------------------------------------------------------------------------------------
\newif\ifsolutions
\solutionstrue




\begin{document}

\begin{center}
		\LARGE\textbf{Exercises for Lecture 6:\\ Optimal mechanisms.}
\end{center}



\section{Malevolent Judicial Design}
	% 410-3 problem bank ps7 q15
	Revisit the Judicial Design exercise (L2 problem 4). Suppose that the defendant's type is $\theta \sim U[0,1]$, which stands for the probability of being acquitted if the defendant goes to the trial. Suppose that the DA wants to maximize the expected length of the defendant's sentence, i.e. to minimize the defendant's expected payoff. (So the DA gets a payoff of $1$ for a life sentence and a payoff of $r$ for a reduced sentence which would give the defendant a payoff of $-r$.)  
	\begin{enumerate}
		\item Among the incentive-compatible mechanisms you identified, what is the optimal mechanism for the DA?
		\item How does your answer change if going to trial imposes additional cost $c \in (0,1)$ on the DA (but not on the defendant) relative to agreeing on a plea bargain?
	\end{enumerate}
	
\ifsolutions
\section*{Solution}
	The implementable social choice functions must look as follows, for some $\bar{\theta} \in [0,1]$ (see the original problem):
	\[ f(\theta)= \begin{cases} r & \text{if } \theta<\bar{\theta} \\
		T & \text{if } \theta\geq\bar{\theta} \end{cases}, \]
	where plea bargain $r= 1-\bar{\theta}$ is offered, and the defendant can choose between that and going to trial. 
	%Note that even if the distribution does not have full support, this inly allows the DA to offer lower sentences in a plea bargain so we can ignore that case.	
	The DA gets $r$ from a plea deal and $1-\theta$ if the defendant goes to trial, so the DA's expected payoff from any such $f(\theta)$ is:
	\begin{equation}
		\label{eq:MJD}
		\begin{aligned}
			\Phi(\bar{\theta}) \cdot (1-\bar{\theta})+\int_{\bar{\theta}}^1 (1-\theta-c) d\Phi(\theta)
			&= \bar{\theta} (1-\bar{\theta}) + \frac{1-2\bar{\theta}+\bar{\theta}^2}{2} - c(1-\bar{\theta}) 
			\\&= (1-\bar{\theta}) \left(\frac{1+\bar{\theta}}{2} - c\right)
		\end{aligned}
	\end{equation}
	\begin{enumerate}
		\item We could maximize \eqref{eq:MJD} over $\bar{\theta}$ directly. However, for $c=0$ there is a more direct solution. Any defendant who takes the the plea bargain gets a lower sentence from the plea bargain than what they would have gotten from trial. Thus, it is clearly optimal for the DA not to offer any plea bargains (except perhaps to $\theta=0$, which will accept a plea bargain of 1), i.e., setting $\bar{\theta}=0$ is optimal.
		
		\item When going to trial imposes cost $c>0$ on the DA, maximizing \eqref{eq:MJD} w.r.t. $\bar{\theta}$ yields the optimal threshold $\bar{\theta}=c$. So in the optimal mechanism, a plea deal $r=1-c$ is offered, sufficiently innocent types $\theta \in [0,c]$ take it, and types $\theta \in (c,1]$ prefer to go to trial.
	\end{enumerate}
\fi




\section{Optimal Procurement Mechanism}
	% NU 410-3 2019, ps6 q3
	Consider an inverted setting to the one discussed in the lecture: a seller now has an item of some privately known quality $\theta \in [0,1]$. Here $\theta$ also equals the seller's valuation of the item, and the buyer's valuation is given by $v(\theta) > \theta$. The \emph{buyer} designs a direct revelation mechanism $(k,t)$ to purchase this item, where $k(\theta)$ is the probability of trade and $t(\theta)$ is the payment from the buyer to the seller.\footnote{Note that this formulation of the problem explicitly constrains the mechanism to be ex post budget balance requirement.} Players' expected utilities given the seller's true type $\theta$ and the seller's report $\hat{\theta}$ are then given by
	\begin{align*}
		U_S(\hat{\theta}|\theta) &= -\theta k(\hat{\theta}) + t(\hat{\theta}),
		\\
		U_B(\hat{\theta}|\theta) &= v(\theta) k(\hat{\theta}) - t(\hat{\theta}).
	\end{align*}
	\begin{enumerate}
		\item Show that for an allocation rule $k(\theta)$ to be IC for the seller, it must be weakly \emph{decreasing} in $\theta$.
		\item ERP implies that the payoff of the seller of type $\theta$ can be written as $U_S(\theta|\theta) = U_S(1|1) + \int_{\theta}^{1} k(s) ds $. Using this expression, show that the buyer's expected utility in any IC DRM $(k,t)$ is given by:
		\begin{align*}
			\mathbb{E}_\theta [ U_B(\theta | \theta) ] = \int_0^1 k(\theta) VS(\theta) \phi(\theta) d\theta - U_S(1|1),
		\end{align*}
		where $VS(\theta) = v(\theta) - \theta - \frac{\Phi(\theta)}{\phi(\theta)}$.
		\item Explain each component of $VS(\theta)$.
		\item Suppose from now on that $\theta \sim U[0,1]$. Find the optimal allocation rule when $v(\theta) = \frac{3\theta}{2}$ for $\theta \in [0,\frac{1}{3}]$ and $v(\theta) = \frac{5\theta}{2}-\frac{1}{3}$ for $\theta \in [\frac{1}{3},1]$.
		\item Find the optimal allocation rule when $v(\theta) = \frac{5\theta}{2}$ for $\theta \in [0,\frac{1}{3}]$ and $v(\theta) = \frac{3\theta}{2}+\frac{1}{3}$ for $\theta \in [\frac{1}{3},1]$.
	\end{enumerate}
		
\ifsolutions
\section*{Solution}
\begin{enumerate}
	\item Take two arbitrary seller types $\theta$ and $\hat{\theta}>\theta$. The IC condition for $\theta$ to not be willing to falsely report $\hat{\theta}$ is
	\begin{align*}
		U_S(\theta|\theta) &\geq U_S (\hat{\theta}|\theta)
		\\
		&\geq -\theta k(\hat{\theta}) + t(\hat{\theta})
		\\
		&\geq -\hat{\theta} k(\hat{\theta}) + t(\hat{\theta}) + (\hat{\theta}-\theta) k(\hat{\theta})
		\\
		&\geq U_S (\hat{\theta}|\hat{\theta}) + (\hat{\theta}-\theta) k(\hat{\theta})
		\\
		\iff k(\hat{\theta}) &\leq - \frac{U_S(\hat{\theta}|\hat{\theta})-U_S(\theta|\theta)}{\hat{\theta}-\theta}.
	\end{align*}
	Applying a similar chain of reasoning to the IC condition for $\hat{\theta}$ to not be willing to report $\theta$ yields
	\begin{align*}
		k({\theta}) &\geq - \frac{U_S(\hat{\theta}|\hat{\theta})-U_S(\theta|\theta)}{\hat{\theta}-\theta},
	\end{align*}
	hence $k(\theta) \geq k(\hat{\theta})$. Types $\theta$ and $\hat{\theta}>\theta$ were arbitrary, hence any implementable $k(\theta)$ must be a weakly decreasing function.
	
	
	\item The expected utility of the buyer can be written as:
	
	$$ \mathbb{E}U_B(\theta) \equiv \mathbb{E}U_B(\theta|\theta) = \mathbb{E}_\theta[v(\theta)k(\theta)-t(\theta)]$$
	
	Rearranging $U_S$ to $t(\theta)=U_S(\theta|\theta)+\theta k(\theta)$ and plugging it into the expected utility of the buyer:
	
	$$ \mathbb{E}U_B(\theta)=\mathbb{E}_\theta[v(\theta)k(\theta)-U_S(\theta|\theta)-\theta k(\theta)]$$
	
	Now, using the envelope theorem and integration by parts yields:
	\begin{align*}
		\mathbb{E}U_B(\theta) &=\mathbb{E}_\theta[(v(\theta)-\theta)k(\theta)-U_S(1|1)-\int_\theta^1k(s)ds]
		\\
		&=\mathbb{E}_\theta \left[ (v(\theta)-\theta)k(\theta)-\int_\theta^1k(s)ds \right]-U_S(1|1)
		\\
		&=\int_0^1 \left[(v(\theta)-\theta)k(\theta)-\int_\theta^1k(s)ds \right] \phi(\theta)d\theta-U_S(1|1)
		\\
		&=\int_0^1(v(\theta)-\theta)k(\theta)\phi(\theta)d\theta  -\int_0^1\int_\theta^1k(s) \phi(\theta) ds d\theta-U_S(1|1)
		\\
		%&=\int_0^1(v(\theta)-\theta)k(\theta)\phi(\theta)d\theta  -\int_0^1\int_0^s k(\theta) \phi(\theta) d\theta ds-U_S(1)
		%\\
		%&=\int_0^1(v(\theta)-\theta)k(\theta)\phi(\theta)d\theta  -\int_0^1 k(s) \left[\int_0^\theta \phi(\theta) d\theta \right] ds-U_S(1)
		%\\
		&=\int_0^1(v(\theta)-\theta)k(\theta)\phi(\theta)d\theta-\int_0^1 k(\theta) \Phi(\theta) d\theta -U_S(1|1)
		\\
		&=\int_0^1 \left(v(\theta)-\theta-\frac{\Phi(\theta)}{\phi(\theta)} \right) k(\theta)\phi(\theta)d\theta -U_S(1|1)
	\end{align*}
	
	
	\item 
	Explain each component of $VS(\theta)$.
	
	$$ VS(\theta)=v(\theta)-\theta-\frac{\Phi(\theta)}{\phi(\theta)} $$
	
	$VS(\theta)$ is the virtual surplus gained by the buyer in this model. $v(\theta)$ is the buyer's valuation, $\theta$ is the seller's valuation which is equal to the quality of the item which is privately known by the seller. The buyer does not know $\theta$ exactly, but he assumes that $\theta$ is a random variable with some cumulative distribution function $\Phi(\theta)$ and probability distribution function $\phi(\theta)$.
	
	Term $v(\theta) - \theta$ represents the \textbf{surplus} generated by trade, this is what the buyer would maximize if he could extract the information about $\theta$ from the seller at no cost. The term $\frac{\Phi(\theta)}{\phi(\theta)}$ is the \textbf{information rent} that must be left to the seller in order to incentivize truthtelling. The buyer thus maximizes surplus net of information rents.
	
	
	\item 
	Calculate virtual surplus $VS(\theta) = v(\theta) - \theta - \frac{\Phi(\theta)}{f(\theta)}$: 
	\begin{align*}
		VS(\theta) &= 
		\begin{cases}
			\frac{3\theta}{2} - \theta - \frac{\theta}{1} &\text{ if } \theta \in [0, \frac{1}{3}]
			\\
			\frac{5\theta}{2} - \frac{1}{3} - \theta - \frac{\theta}{1} &\text{ if } \theta \in [\frac{1}{3}, 1]
		\end{cases}
		\\
		\Leftrightarrow
		VS(\theta) &= 
		\begin{cases}
			-\frac{\theta}{2} &\text{ if } \theta \in [0, \frac{1}{3}]
			\\
			\frac{\theta}{2} - \frac{1}{3} &\text{ if } \theta \in [\frac{1}{3}, 1]
		\end{cases}
	\end{align*}
	Pointwise optimization prescribes setting $k(\theta) = 1$ if $VS(\theta) \geq 0$ and $k(\theta) = 0$ otherwise. In this problem this would result in allocation $k(\theta) = \mathbb{I} \left\{ \theta \geq \frac{2}{3} \right\}$, which is not weakly decreasing as monotonicity requires.
	Conversely, it is weakly increasing. The decreasing function that is ``closest'' to some increasing function is a constant function.
	Therefore, let us look at constant allocations $k(\theta) = \bar{k}$ instead. By linearity of buyer's payoff in $\bar{k}$ in that case, one of $\bar{k} \in \{0,1\}$ must be optimal (and $\bar{k} \in (0,1)$ cannot be optimal).
	
	Allocation rule corresponding to $\bar{k} = 0$ prescribes no trade w.p. 1, hence buyer's payoff is zero. Allocation rule $\bar{k} = 1$ prescribes trade w.p. 1 at a constant price, hence this price must be $\bar{t} = \max \theta$ for all seller types to be willing to sell. Buyer's expected payoff is then equal to
	\begin{align*}
		\mathbb{E} \left[ v(\theta) - 1 \right] &= \int_0^{\frac{1}{3}} \frac{3\theta}{2} d\theta + \int_{\frac{1}{3}}^{1} \left[ \frac{5 \theta}{2} - \frac{1}{3} \right] d\theta -1 = \frac{35}{36} - 1 < 0,
	\end{align*}
	hence no trade ($k(\theta) = 0$ for all $\theta$) is optimal.
	
	
	\item 	
	In this case we have
	\begin{align*}
		VS(\theta) &= 
		\begin{cases}
			\frac{\theta}{2} &\text{ if } \theta \in [0, \frac{1}{3}]
			\\
			-\frac{\theta}{2} + \frac{1}{3} &\text{ if } \theta \in [\frac{1}{3}, 1]
		\end{cases}
	\end{align*}
	Pointwise maximization yields $k(\theta) = \mathbb{I} \left\{ \theta \leq \frac{2}{3} \right\}$. Monotonicity is not violated (the allocation is weakly decreasing in $\theta$), hence this allocation is implementable and, so, optimal.
\end{enumerate}

\textbf{NOTE}: the answers to parts 4 and 5 above do not constitute a full derivation of the optimal mechanism, since they do not handle the buyer's choice of $U_S(1|1)$ and the corresponding discussion of the seller's IR constraints. The problem does not ask for this (and only inquires about the \emph{optimal allocation rule}), but if you were asked instead to derive the full \emph{optimal mechanism}, these extra steps would be expected.
\fi


	
\section{Uber Optimal Algorithm}
% opt.mech (not matching)
Suppose you are the head economist of Uber and you are designing the economic side of the matching algorithm. Your goal is to pay the drivers as little as possible, while also ensuring their participation. In particular, consider the following situation: some consumer has placed a fare (a ride order) in the app, and there is a driver available in the vicinity. You (the app) are then effectively bargaining with the driver for how little money they are willing to accept in order to complete this fare.

Suppose the app charges the consumer some amount $w$ for the ride. This $w$ is fixed and commonly known by all players, including the driver and the designer. The driver values their time at $\theta \sim U[0,1]$, which is their private information. You are designing a direct revelation mechanism $\{k(\theta),p(\theta)\}_{\theta\in[0,1]}$, which works as follows:
\begin{enumerate}[label=(\roman{enumi})]
	\item the driver reports $\theta$ to the app;
	\item the app offers the fare to the driver with probability $k(\theta) \in [0,1]$;\footnote{Think that if the fare is not offered to the driver, then the consumer sees an empty screen, as if there were no available drivers in their area.}
	\item the driver can accept or reject the fare;
	\item if the driver accepted and completed the fare, they receive payment $p(\theta)$;
	\item if the driver declined or was not offered the fare, they receive utility $\theta$.
\end{enumerate}

Therefore, the driver's expected utility from receiving with probability $k$ a fare that pays $p$ is
$$u(k,t,\theta) = k \cdot p + (1-k) \cdot \theta,$$
and their outside option (from rejecting the fare or the whole mechanism) is $\underline{U}(\theta) = \theta$.

Your task is to devise an optimal mechanism $(k,p)$ that maximizes the firm's expected revenue $\mathbb{E}_\theta [k(\theta) \cdot (w-p(\theta))]$ subject to the driver's standard IC constraint and interim IR constraint $u(k,t,\theta) \geq \underline{U}(\theta)$. To derive this mechanism, follow the steps below.

%\emph{NOTE: you can attempt to answer each of parts 2-5 even if you did not solve the earlier parts (you can use the statements made in the problem text).}

\begin{enumerate}
	\item Show that in any IC mechanism, $k(\theta)$ must be weakly decreasing.
	\item Show that in any IC mechanism, the following holds for all $\theta$ (where $U(\theta) \equiv k(\theta) p(\theta) + (1-k(\theta)) \theta$):
	\begin{align}
		\label{opt:ERP2}
		U(\theta) = U(1) - \int_{\theta}^{1} (1-k(s)) ds.
	\end{align}
	\item Show that in any IC mechanism, the firms' expected profit (from this driver) can be expressed in the following way as a function of the allocation rule $k$ and $U(1)$:
	\begin{align}
		\label{opt:ERP3}
		\mathbb{E}_\theta [k(\theta)\cdot (w-p(\theta))] = \int_0^1 \left[ 2\theta + k(\theta) \cdot (w - 2\theta ) \right] d\theta - U(1).
	\end{align}
	\item Find the allocation rule $k$ that maximizes the expected profit \eqref{opt:ERP3}. Does it satisfy the monotonicity requirement from part 1? If not, what is the optimal monotone allocation rule?
	\item Argue (formally if you can) why type $\theta=1$ is the one for whom the IR constraint will be the most binding. I.e., show that if IR holds for $\theta=1$ then it also holds for all other $\theta \in [0,1)$.
	\item Suppose $w=1$. Derive the payment rule $p(\theta)$ that supports the optimal [monotone] allocation rule.
	\item Suppose $w=2$. Derive the payment rule $p(\theta)$ that supports the optimal [monotone] allocation rule.
	\item Are the mechanisms you obtained in the two previous questions ex post IR for the drivers? I.e., will the driver always accept any fare that is offered to them?
	%NOTE: the last question is a full dupe of part 5, since interim and ex post IR are equivalent in single-player problems.
\end{enumerate}


\ifsolutions
\section*{Solution}
\begin{enumerate}
	\item The argument fully mirrors the argument from class and homeworks. Consider two types $\theta > \theta'$. The IC condition for $\theta$ to not be willing to report $\theta'$ is:
	\begin{align*}
		U(\theta) \equiv k(\theta) p(\theta) + (1-k(\theta)) \theta &\geq k(\theta') p(\theta') + (1-k(\theta')) \theta
		\\
		&= U(\theta') + (1-k(\theta')) (\theta-\theta').
	\end{align*}
	Rearranging and dividing both sides by $(\theta-\theta')$ yields
	\begin{align*}
		\frac{U(\theta)-U(\theta')}{\theta-\theta'} \geq 1-k(\theta').
	\end{align*}
	By doing the same manipulations for the IC condition for type $\theta'$ to not be willing to report type $\theta$, we obtain
	\begin{align}
		\label{opt:mon}
		1-k(\theta) \geq \frac{U(\theta)-U(\theta')}{\theta-\theta'} \geq 1-k(\theta'),
	\end{align}
	hence $k(\theta) \leq k(\theta')$.
	
	\item Taking the limit as $\theta' \to \theta$, \eqref{opt:mon} becomes $\frac{dU(\theta)}{d\theta} = 1-k(\theta)$ (for almost all $\theta$). Invoking the fundamental theorem of calculus, we can say that for any $\theta$ then,
	\begin{align}
		\label{opt:ERP}
		U(1) - U(\theta) = \int_{\theta}^{1} \frac{dU(s)}{ds} ds = \int_{\theta}^{1} (1-k(s)) ds.
	\end{align}
	Rearranging this expression yields the result.
	
	\item Using \eqref{opt:ERP} and the definition of $U(\theta)$, we can express the average payment to type $\theta$ as
	\begin{align}
		\label{opt:ERP1}
		k(\theta)p(\theta) &= -(1-k(\theta)) \theta - \int_{\theta}^{1} (1-k(s)) ds + U(1),
	\end{align}
	hence the firm's expected profit from type $\theta$ is
	\begin{align*}
		k(\theta)\cdot (w-p(\theta)) &= wk(\theta) + (1-k(\theta)) \theta + \int_{\theta}^{1} (1-k(s)) ds - U(1).
	\end{align*}
	Taking the expectation over types $\theta$, we get the expression for the expected profit:
	\begin{align*}
		\mathbb{E}_\theta [k(\theta)\cdot (w-p(\theta))] &= \int_0^1 \left[ wk(\theta) + (1-k(\theta)) \theta + \int_{\theta}^{1} (1-k(s)) ds \right] d\Phi(\theta) - U(1).
	\end{align*}
	Since $\theta \sim U[0,1]$, we have that $\Phi(\theta) = \theta$ for $\theta \in [0,1]$. Using integration by parts to eliminate the inner integral and then simplifying the resulting expression, we get
	\begin{align*}
		\mathbb{E}_\theta [k(\theta)\cdot (w-p(\theta))] &= \int_0^1 \left[ wk(\theta) + (1-k(\theta)) \theta + \theta (1-k(\theta)) \right] d\theta - U(1)
		\\
		&= \int_0^1 \left[ 2\theta + k(\theta) \cdot (w - 2\theta ) \right] d\theta - U(1).
	\end{align*}
	
	\item Maximizing the expression under the integral for any $\theta$, we get that $k(\theta) = \mathbb{I}\left\{ \theta \leq \frac{w}{2} \right\}$. This allocation rule is indeed weakly decreasing.
	
	\item Recall $\underline{U}(\theta)=\theta$. From \eqref{opt:ERP} (equivalently, \eqref{opt:ERP3}) and the fact that $k(\theta) \geq 0$, we can infer that for all $\theta$,
	\begin{align*}
		&U(1) - U(\theta) \leq 1-\theta
		\\
		\Leftrightarrow &U(1) - 1 \leq U(\theta) - \theta.
	\end{align*}
	Hence if $U(1)\geq 1 \iff U(1)-1 \geq 0$, then $U(\theta)-\theta \geq 0 \iff U(\theta) \geq \theta$.
	
	\item %The ``proper'' way to answer this problem is as follows.
	Transfers are pinned down by $k$ and $U(1)$ by the envelope representation of payoffs \eqref{opt:ERP3}. We have $k$ from part 4. From part 5 we know that $U(1)=1$ is both necessary and sufficient for all IR constraints to hold and for at least one of them to bind. Plugging the both of these into \eqref{opt:ERP1}, we get that for $\theta \leq \frac{w}{2}$,
	\begin{align*}
		k(\theta)p(\theta) &= -(1-k(\theta)) \theta - \int_{\theta}^{1} (1-k(s)) ds + U(1)
		\\
		\Rightarrow \text{ if $k(\theta)=1$, } p(\theta) &= - \int_{\theta}^{1} (1-k(s)) ds + 1
		\\
		&= - \int_{\theta}^{w/2} 0 ds - \int_{w/2}^1 1 ds + 1
		\\
		&= 1 - \left(1-\frac{w}{2}\right) = \frac{w}{2}.
	\end{align*}
	Hence if $w=1$, any driver that receives the fare ($\theta < \frac{w}{2}$) is paid $p(\theta) = 1/2$. Drivers who report $\theta > w/2$ are not offered a fare and are paid nothing.\footnote{The exact value of $p(\theta)$ is indeterminate in this case, since $p$ is defined as payment \emph{conditional} on completing the fare.}
	
	\item Using the results from the previous parts, if $w=2$ then the optimal mechanism is $k(\theta) = 1$ for all $\theta$ and $p(\theta)=1$, i.e., the driver receives this offer and is compensated handsomely regardless of their report.
	
	\item Yes. If $\theta < w/2$, the driver is offered a fare and a reward $p(\theta) = w/2$, so accepting the fare for $p(\theta)$ is better than rejecting and receiving $\underline{U}(\theta)=\theta$.
\end{enumerate}
\fi



\section{Divine intervention}
%midterm 2020 p2
%BIC mech, gVCG, optimal mechanism

The year is 854 AD. The place is Denmark. The reigning king Horik is challenged by his nephew Guttorm for the claim to the kingdom. Both know that a grand battle between them in inevitable, and both are praying to Odin and the rest of {\AE}sir to tilt the outcome of this battle in their favor. You are to assume the role of Odin and to decide the outcome of the battle.

In particular, you are a mechanism designer dealing with two players $i=H,G$. Every player $i$ has a private type $\theta_i \sim U[0,1]$ ($\theta_H$ and $\theta_G$ are indepedent). An outcome is given by $x=(k,t)$, where $k=(k_H,k_G)$ is an allocation such that $k_i \in [-1,1]$ and $k_H + k_G \leq 0$, and $t$ is a vector of transfers. Players' payoffs are given by $u_i(x,\theta) = k_i \theta_i - t_i$. The outside options are normalized to zero.

In our story, allocations represent who wins the battle: e.g., $(k_H,k_G)=(1,-1)$ means Horik wins while Guttorm loses and is killed in battle. Restriction $k_H + k_G \leq 0$ means that they cannot both win, but can both lose. Transfer $t_i$ need not mean money, but rather (the negative of) favor that the gods will show to $i$ outside of battle, in life or afterlife.
Horik's and Guttorm's types represent their paltriness. Higher $\theta_i$ means that $i$ would very much prefer to become a king and is very afraid of death. Low $\theta_i$ means that $i$ values honorable death in combat almost as highly as reign over the realm. Finally, the ``outside option'' represents fleeing from the battle, retaining life but losing the kingdom. The level of ``favor'' $t_i$ in this case is normalized to zero (i.e., favor is measured relative to this scenario).

For the first part of this problem, suppose that Odin \& the co-gods love a good battle (so do not want players to flee), but are otherwise benevolent and do not care about favor. They thus decide to use the generalized VCG mechanism to determine the outcome.

\begin{enumerate}
	\item Find the efficient allocation rule $k^*(\theta) = \arg \max_k \{u_H(k,\theta) + u_G(k,\theta)\}$.
	\item Find the least charitable types $\tilde{\theta}_i$.
	\item Calculate the gVCG transfer rule $t^{gVCG}(\theta)$ that supports the efficient allocation rule.
\end{enumerate}

Suppose now instead that the gods are not benevolent, but try to minimize the amount of favor they owe to mortals -- i.e., to maximize $\mathbb{E}[t_H+t_G]$. That said, they still like to see a good battle, so ensuring that neither player decides to flee takes priority.

\begin{enumerate}[resume]
	\item Find the optimal BIC mechanism that maximizes the expected ``revenue'' $\mathbb{E}_\theta[t_H(\theta)+t_G(\theta)]$ subject to the players' IR constraints.
\end{enumerate}


\ifsolutions
\section*{Solution}

\begin{enumerate}
	\item The efficient allocation is obviously (you may have a different tie-breaking
	rule)
	\begin{align*}
		k^{*}(\theta) & =\begin{cases}
			(1,-1) & \text{ if }\theta_{H}>\theta_{G};\\
			(0, 0) & \text{ if }\theta_{H}=\theta_{G};\\
			(-1,1) & \text{ if }\theta_{H}<\theta_{G}.
		\end{cases}
	\end{align*}
	
	\item The least charitable type is 
	\begin{align*}
		\tilde{\theta}_{i} & \equiv \arg\min_{\theta_{i}} \mathbb{E}_{\theta_{-i}} \left\{ \theta_{H} k^*_{H}(\theta) + \theta_{G} k^*_{G}(\theta) - 0 \right\} 
		\\
		& =\arg\min_{\theta_{i}}\mathbb{E}_{\theta_{j}} \left\{  \left(\theta_{i}-\theta_{j}\right) k_{i}^{*} (\theta) \right\} 
		\\
		& =0.5
	\end{align*}
	
	\item The gVCG transfer rule for $i$ is
	\begin{align*}
		t^{gVCG}_i(\theta_i,\theta_{-i}) &= \theta_j k_j^*(\tilde{\theta}_i,\theta_{j}) + \tilde{\theta}_i k_i^*(\tilde{\theta}_i,\theta_{j}) - \theta_j k_j^*({\theta}_i,\theta_{j}) - \underline{U}_i (\tilde{\theta}_i)
		\\
		&= |0.5-\theta_j| - \theta_j \cdot \text{sgn}(\theta_j - \theta_i)
		\\
		&= \begin{cases}
			|0.5-\theta_j| - \theta_j & \text{ if } \theta_i < \theta_j,
			\\
			|0.5-\theta_j| 			& \text{ if } \theta_j = \theta_i,
			\\
			|0.5-\theta_j| + \theta_j & \text{ if } \theta_i > \theta_j.
		\end{cases}
	\end{align*}
	I.e., if $\theta_j < 0.5$ then $i$ pays $0.5$ if he wins and $0.5-2\theta_j \gtrless 0$ if he loses; while if $\theta_j > 0.5$ then $i$ pays $2\theta_j - 0.5 > 0$ if he wins and receives $0.5$ if he loses.
	
	\item Invoke BIC ERP (we can use it since the problem fits the Euclidean setting):
	\begin{align}
		\bar{U}_i(\theta_i) &= \bar{U}_i(0) + \int_0^{\theta_i} \mathbb{E}_{\theta_{-i}} [k_i(s,\theta_{-i})] ds
	\end{align}
	and substitute the definition of the expected utility $\bar{U}_i(\theta_i)$ to get
	\begin{align}
		\mathbb{E}_{\theta_{-i}} [t_i(\theta_i,\theta_{-i})] 
		&= \theta_i \mathbb{E}_{\theta_{-i}} [k_i(\theta_i,\theta_{-i})] - \bar{U}_i(0) - \int_0^{\theta_i} \mathbb{E}_{\theta_{-i}} [k_i(s,\theta_{-i})] ds
		\\
		&= \int_0^1 \theta_i k_i(\theta_i,\theta_{-i}) \phi(\theta_{-i}) d\theta_{-i} - \int_0^1 \left( \int_0^{\theta_i} k_i(s,\theta_{-i}) ds \right) \phi(\theta_{-i}) d\theta_{-i} - \bar{U}_i(0).
	\end{align}
	The second line rewrites the expectations as integrals. Taking the expectation of both sides over $\theta_i$ as well and recalling that pdfs are $\phi(\theta_i)=1$ for $U[0,1]$ distribution, we get
	\begin{align}
		\mathbb{E}_{\theta} [t_i(\theta_i,\theta_{-i})] 
		&= \int_0^1 \int_0^1 \theta_i k_i(\theta_i,\theta_{-i}) d\theta_{-i} d\theta_{i} - \int_0^1 \int_0^1 \int_0^{\theta_i} k_i(s,\theta_{-i}) ds d\theta_{i} d\theta_{-i} - \bar{U}_i(0)
		\label{eq:opt4}
		\\
		&= \int_0^1 \int_0^1 \theta_i k_i(\theta_i,\theta_{-i}) d\theta_{-i} d\theta_{i} - \int_0^1 \int_0^1 (1-\theta_i) k_i(\theta_i,\theta_{-i}) d\theta_{i} d\theta_{-i} - \bar{U}_i(0)
		\label{eq:opt5}
		\\
		&= \int_0^1 \int_0^1 \left( \theta_i k_i(\theta) - (1-\theta_i) k_i(\theta) \right) d\theta_{i} d\theta_{-i} - \bar{U}_i(0)
		\label{eq:opt6}
		\\
		&= \int_0^1 \int_0^1 \left( (2\theta_i - 1) k_i(\theta) \right) d\theta_{i} d\theta_{-i} - \bar{U}_i(0).
		\label{eq:opt7}
	\end{align}
	In the above, from \eqref{eq:opt4} to \eqref{eq:opt5} we used integration by parts as in class, then combined the two integrals to get \eqref{eq:opt6} and simplified the resulting expression in \eqref{eq:opt7}. The total expected ``revenue'' (negative of the favor owed) from both players is then given by
	\begin{align}
		\mathbb{E}_\theta \left[ t_H(\theta)+t_G(\theta) \right] 
		&= \int_0^1 \int_0^1 \left[ (2\theta_H - 1) k_H(\theta) + (2\theta_G - 1) k_G(\theta) \right] d\theta_H d\theta_G - \bar{U}_G(0) - \bar{U}_H(0).
		\label{eq:opt8}
	\end{align}
	
	The goal is to maximize the expression above over $k$. To maximize the integral pointwise ($\theta$-by-$\theta$), we would want to set $k_i(\theta) = -1$ if $\theta_i < 0.5$ and $k_i(\theta) = 1$ if $\theta_i > 0.5$. The former is not a problem -- in particular, if both $\theta_H,\theta_G < 0.5$, then both Horik and Guttorm would die in battle.\footnote{According to legends, this was the actual outcome: ``A huge battle was fought which lasted for three days. King Horik I ``and the other kings'' were killed, as were Guttorm and a great many chiefs''. (\url{https://en.wikipedia.org/wiki/Horik_I\#Downfall})}
	The latter, however, is not possible whenever both $\theta_H,\theta_G>0.5$, since we have the constraint that $k_H+k_G \leq 0$ -- both cannot win at the same time. The constrained-optimal allocation that maximizes $(2\theta_H - 1) k_H(\theta) + (2\theta_G - 1) k_G(\theta)$ s.t. $k_H+k_G \leq 0$ would be giving the victory to the person with the higher $\theta_i$ when $\theta_H,\theta_G>0.5$. In the end, the allocation rule in the optimal mechanism is given by
	\begin{align*}
		k(\theta) & =\begin{cases}
			(1,-1) & \text{ if }\theta_{H}>\max\{\theta_{G},0.5\};\\
			(-1,1) & \text{ if }\theta_{G}>\max\{\theta_{H},0.5\};\\
			(-1,-1) & \text{ if }0.5\geq \max\{\theta_H,\theta_G\}.
		\end{cases}
	\end{align*}
	Monotonicity holds: $k_i(\theta_i,\theta_{-i})$ is weakly increasing in $\theta_i$ for all $\theta_{-i}$, hence $\mathbb{E}_{\theta_{-i}} [k_i(\theta_i,\theta_{-i})]$ is also weakly increasing in $\theta_i$, hence this allocation rule $k$ is indeed implementable in BNE. In fact, the former statement implies that $k$ is even implementable in dominant strategies.
	
	To calculate transfers, go back to ERP. You can actually use either BIC, or DSIC ERP to obtain transfers that will support $k$ in BNE or in dominant strategies, respectively. Let us take BIC ERP:
	\begin{align*}
		\mathbb{E}_{\theta_{-i}} [t_i(\theta_i,\theta_{-i})] 
		&= \theta_i \mathbb{E}_{\theta_{-i}} [k_i(\theta_i,\theta_{-i})] - \bar{U}_i(0) - \int_0^{\theta_i} \mathbb{E}_{\theta_{-i}} [k_i(s,\theta_{-i})] ds
		\\
		&= \begin{cases}
			\theta_i(-1) - \int_0^{\theta_i}(-1)ds - \bar{U}_i(0)	& \text{ if } \theta_i \leq 0.5;
			\\
			\theta_i (2\theta_i-1) - \int_0^{0.5}(-1)ds - \int_{0.5}^{\theta_i} (2s-1) ds - \bar{U}_i(0)	& \text{ if } \theta_i > 0.5;
		\end{cases}
		\\
		&= \begin{cases}
			- \bar{U}_i(0)	& \text{ if } \theta_i \leq 0.5;
			\\
			\theta_i^2 + \frac{1}{4} - \bar{U}_i(0)	& \text{ if } \theta_i > 0.5.
		\end{cases}
	\end{align*}
	This gives us the expected (over $\theta_{-i}$) transfer of $i$ given $\theta_i$, but how do can we get $t_i(\theta_i, \theta_{-i})$? A simple answer is: unless we care about ex post IR or BB, there is no real reason in BIC mechanisms to make $t_i$ contingent on $\theta_{-i}$. I.e., given $\theta_i$, for any $\theta_{-i}$ we can just set $i$'s transfer to be equal to\footnote{
		An alternative path is, as was mentioned previously, to use DSIC ERP to obtain transfers $t$ that support our $k$ in DS. If you did that, you would get
		$$t_i(\theta_i,\theta_{-i}) = 
		\begin{cases}
			- U_i(0,\theta_{-i})	& \text{ if } \theta_i \leq 0.5;
			\\
			2\max\{\theta_{-i}, 0.5\} - U_i(0,\theta_{-i})	& \text{ if } \theta_i > 0.5.
		\end{cases}$$
	} 
	$$t_i(\theta_i) = \mathbb{E}_{\theta_{-i}} [t_i(\theta_i,\theta_{-i})] = 
	\begin{cases}
		- \bar{U}_i(0)	& \text{ if } \theta_i \leq 0.5;
		\\
		\theta_i^2 + \frac{1}{4} - \bar{U}_i(0)	& \text{ if } \theta_i > 0.5.
	\end{cases}$$
	
	We are almost done. The only thing left is to pin down the utilities $\bar{U}_i(0)$, which would also pin down the transfers. According to \eqref{eq:opt8}, we want to set them as low as possible, but we also want to satisfy IR. Write out players' expected utility:
	\begin{align*}
		\bar{U}_i (\theta_i) &= \theta_i \mathbb{E}_{\theta_{-i}} [k_i(\theta_i,\theta_{-i})] - \mathbb{E}_{\theta_{-i}} [t_i(\theta_i,\theta_{-i})] 
		\\
		&= \begin{cases}
			-\theta_i + \bar{U}_i(0)	& \text{ if } \theta_i \leq 0.5;
			\\
			\theta_i^2 - \theta_i - \frac{1}{4} + \bar{U}_i(0)	& \text{ if } \theta_i > 0.5.
		\end{cases}
	\end{align*}
	It is minimized at $\theta_i=0.5$, meaning that if the IR constraint holds for type $\theta_i=0.5$ then it will also hold for all other types.%\footnote{While this coincides with the least charitable type in this problem, this is purely by coincidence.} %NOTE: is it though? Isn't it the point of the LCT?
	Setting the IR constraint to bind for that type ($\bar{U}_i(0.5)=0$), we obtain $\bar{U}_i(0) = 0.5$, so in the end, the transfers that support the favor-minimizing allocation $k$ in BNE are given by
	$$t_i(\theta_i) = 
	\begin{cases}
		- 0.5	& \text{ if } \theta_i \leq 0.5;
		\\
		\theta_i^2 - \frac{1}{4}	& \text{ if } \theta_i > 0.5.
	\end{cases}$$
\end{enumerate}
\fi


\end{document}
