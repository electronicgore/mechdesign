%%% License: Creative Commons Attribution Share Alike 4.0 (see https://creativecommons.org/licenses/by-sa/4.0/)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[a4paper]{article}

\usepackage{amssymb}
\usepackage{enumerate}
\usepackage[usenames,dvipsnames]{color}
\usepackage{fancyhdr} % Required for custom headers
\usepackage{lastpage} % Required to determine the last page for the footer
\usepackage{extramarks} % Required for headers and footers
\usepackage[usenames,dvipsnames]{color} % Required for custom colors
\usepackage{graphicx} % Required to insert images
\usepackage{listings} % Required for insertion of code
\usepackage{courier} % Required for the courier font
\usepackage[table]{xcolor}
\usepackage{amsfonts,amsmath,amsthm,parskip,setspace,url}
\usepackage[section]{placeins}
\usepackage[a4paper]{geometry}
\usepackage[USenglish]{babel}
\usepackage[utf8]{inputenc}


% Margins
\topmargin=-0.45in
\evensidemargin=0in
\oddsidemargin=0in
\textwidth=6.5in
\textheight=9.0in
\headsep=0.6in

\linespread{1.1} % Line spacing



%----------------------------------------------------------------------------------------
%   FORMATTING
%----------------------------------------------------------------------------------------
% Set up the header and footer
\pagestyle{fancy}
\lhead[c]{\textbf{{\color[rgb]{.5,0,0} K{\o}benhavns\\Universitet }}} % Top left header
\chead{\textbf{{\color[rgb]{.5,0,0} \Class }}\\ \hmwkTitle  } % Top center head
\rhead{\instructor \\ \theprofessor} % Top right header
\lfoot{\lastxmark} % Bottom left footer
\cfoot{} % Bottom center footer
\rfoot{Page\ \thepage\ of\ \protect\pageref{LastPage}} % Bottom right footer
\renewcommand\headrulewidth{0.4pt} % Size of the header rule
\renewcommand\footrulewidth{0.4pt} % Size of the footer rule


% Other formatting stuff
%\setlength\parindent{12pt}
\setlength{\parskip}{5 pt}
%\theoremstyle{definition} \newtheorem{ex}{\textbf{\Large{Exercise & #}\\}}
\usepackage{titlesec}
\titleformat{\section}[hang]{\normalfont\bfseries\Large}{Problem \thesection:}{0.5em}{}




%----------------------------------------------------------------------------------------
%	NAME AND CLASS SECTION
%----------------------------------------------------------------------------------------
\newcommand{\hmwkTitle}{Exercises for Lecture 4} % Assignment title
\newcommand{\Class}{Mechanism Design} % Course/class
\newcommand{\instructor}{Fall 2022} % TA
\newcommand{\theprofessor}{Prof. Egor Starkov} % Professor




%----------------------------------------------------------------------------------------
%   SOLUTIONS
%----------------------------------------------------------------------------------------
\newif\ifsolutions
\solutionstrue




\begin{document}

\begin{center}
		\LARGE\textbf{Exercises for Lecture 4:\\ Revenue equivalence}
\end{center}



\section{Payoff equivalence in BIC mechanisms}

	Prove the payoff equivalence result for BIC mechanisms using the analog of the argument we had for DSIC mechanisms (i.e., by showing monotonicity first). Assume that players' types are mutually independent.
	
\ifsolutions
\section*{Solution}

	BIC IC constraints for types $\theta_i$ and $\hat{\theta}_i$ to not be willing to mimic each other are:
	\begin{align}
		\mathbb{E}_{\theta_{-i}}\left[ \theta_{i} k(\theta_i,\theta_{-i}) - t(\theta_i,\theta_{-i}) \right] &\geq 
		\mathbb{E}_{\theta_{-i}}\left[ \theta_{i} k(\hat{\theta}_i,\theta_{-i}) - t(\hat{\theta}_i,\theta_{-i}) \right],
		\label{eq:IC1}
		\\
		\mathbb{E}_{\theta_{-i}}\left[ \hat{\theta}_{i} k(\theta_i,\theta_{-i}) - t(\theta_i,\theta_{-i}) \right] &\leq 
		\mathbb{E}_{\theta_{-i}}\left[ \hat{\theta}_{i} k(\hat{\theta}_i,\theta_{-i}) - t(\hat{\theta}_i,\theta_{-i}) \right].
		\label{eq:IC2}
	\end{align}
	Add and subtract $\hat{\theta}_{i} k(\hat{\theta}_i,\theta_{-i})$ from the right-hand side of \eqref{eq:IC1} to obtain
	\begin{align}
		\bar{U}_i(\theta_i) \geq \bar{U}_i(\hat{\theta}_i) + (\theta_i - \hat{\theta}_i) \mathbb{E}_{\theta_{-i}}\left[ k(\hat{\theta}_i,\theta_{-i}) \right], \label{eq:IC1b}
	\end{align}
	where $\bar{U}_i(\theta_i)$ is the interim expected utility of type $\theta_i$ from truthtelling: $\bar{U}_i(\theta_i) \equiv \mathbb{E}_{\theta_{-i}}\left[ \theta_{i} k(\theta_i,\theta_{-i}) - t(\theta_i,\theta_{-i}) \right] = \mathbb{E}_{\theta_{-i}}\left[ U(\theta_i,\theta_{-i}) \right]$.
	Doing an analogous manipulation with \eqref{eq:IC2}, combining the resulting inequality with \eqref{eq:IC1b}, and rearranging the two then yields the following, under the assumption that $\theta_i > \hat{\theta}_i$ (you can do the same with the converse):
	\begin{align}
		\mathbb{E}_{\theta_{-i}}\left[ k(\theta_i,\theta_{-i}) \right] \geq \frac{\bar{U}_i(\theta_i) - \bar{U}_i(\hat{\theta}_i)}{\theta_i - \hat{\theta}_i} \geq \mathbb{E}_{\theta_{-i}}\left[ k(\hat{\theta}_i,\theta_{-i}) \right] .
		\label{eq:ICsandwich}
	\end{align}
	The expected allocation $K_i(\theta_i) \equiv \mathbb{E}_{\theta_{-i}}\left[ k(\theta_i,\theta_{-i}) \right]$ is thus monotone in $\theta_i$. Monotonicity implies continuity almost everywhere, hence the following is true for almost all $\theta_i$:
	\begin{align}
		\lim_{\hat{\theta}_i \to \theta_i} K_i(\theta_i) = K_i(\hat{\theta}_i).
		\label{eq:Klimit}
	\end{align}
	Now take limits of \eqref{eq:ICsandwich} as $\hat{\theta}_i \to \theta_i$. By the theorem about two policemen\footnote{\url{https://en.wikipedia.org/wiki/Squeeze_theorem}} together with \eqref{eq:Klimit}, we have that
	\begin{align}
		\lim_{\hat{\theta}_i \to \theta_i} \frac{\bar{U}_i(\theta_i) - \bar{U}_i(\hat{\theta}_i)}{\theta_i - \hat{\theta}_i} = K_i(\theta_i)
		\label{eq:derivlimit}
	\end{align}
	for almost all $\theta_i$.
	The left-hand side of \eqref{eq:derivlimit} is the definition of the derivative of $\bar{U}_i$, hence $\frac{d\bar{U}_i(\theta_i)}{d \theta_i}$ exists and $\frac{d\bar{U}_i(\theta_i)}{d \theta_i} = K_i(\theta_i)$ almost everywhere.\footnote{At points of discontinuity of $K_i(\theta_i)$, function $\bar{U}_i(\theta_i)$ will have a kink, and all values between the two limits $\lim_{\hat{\theta}_i \nearrow \theta_i} K_i(\hat{\theta}_i)$ and $\lim_{\hat{\theta}_i \searrow \theta_i} K_i(\hat{\theta}_i)$ will be subderivatives of $\bar{U}_i$ at that point. For purposes of applying the Fundamental theorem of calculus, we can safely take $K_i(\theta_i)$ to mean the derivative of $\bar{U}_i$ at such points.}
	Applying the Fundamental theorem of calculus, we get that for any $\hat{\theta}_i$, the following holds:
	\begin{align}
		\bar{U}_i(\theta_i) &= \bar{U}_i(\hat{\theta}_i) + \int_{\hat{\theta}_i}^{\theta_i} K_i(s) ds
		\\
		&= \bar{U}_i(\hat{\theta}_i) + \int_{\hat{\theta}_i}^{\theta_i} \mathbb{E}_{\theta_{-i}}\left[ k(s,\theta_{-i}) \right] ds.
	\end{align}
	We have obtained the envelope representation of payoffs, and now we can make the final step towards the revenue equivalence. Recall that
	\begin{align*}
		\bar{U}_i(\theta_i) &= \mathbb{E}_{\theta_{-i}}\left[ \theta_{i} k(\theta_i,\theta_{-i}) - t(\theta_i,\theta_{-i}) \right]
		\\ \Leftrightarrow
		\mathbb{E}_{\theta_{-i}}\left[ t(\theta_i,\theta_{-i}) \right] &= -\bar{U}_i(\theta_i) + \mathbb{E}_{\theta_{-i}}\left[ \theta_{i} k(\theta_i,\theta_{-i}) \right] 
		\\
		&= -\bar{U}_i(\hat{\theta}_i) - \int_{\hat{\theta}_i}^{\theta_i} \mathbb{E}_{\theta_{-i}}\left[ k(s,\theta_{-i}) \right] ds + \mathbb{E}_{\theta_{-i}}\left[ \theta_{i} k(\theta_i,\theta_{-i}) \right] .
	\end{align*}
	Therefore, for any two BIC DRMs $x=(k,t)$ and $x'=(k',t')$, if $\mathbb{E}_{\theta_{-i}}\left[ \theta_{i} k(\theta_i,\theta_{-i}) \right] = \mathbb{E}_{\theta_{-i}}\left[ \theta_{i} k'(\theta_i,\theta_{-i}) \right]$, then 
	\begin{align*}
		\mathbb{E}_{\theta_{-i}}\left[ t(\theta_i,\theta_{-i}) \right] - \mathbb{E}_{\theta_{-i}}\left[ t'(\theta_i,\theta_{-i}) \right]
		=
		-\bar{U}_i(\hat{\theta}_i) + \bar{U}'_i(\hat{\theta}_i),
	\end{align*}
	where on the RHS we have the equilibrium (truthtelling) utilities of some fixed type $\hat{\theta}_i$ in the two mechanisms. Denoting this difference by $h_i$ proves the statement of revenue equivalence.\footnote{To clarify why exactly we can denote $h_i \equiv -\bar{U}_i(\hat{\theta}_i) + \bar{U}'_i(\hat{\theta}_i)$: note that once we fix some respective ``comparison types'' $\hat{\theta}_i$ for every player $i$, this expression only depends on the identity of player $i$, but not on their actual type $\theta_i$, and not on other players' reports $\theta_{-i}$.}
\fi



\section{Payoff equivalence in auctions}

Consider an auction for one item and $N$ bidders with valuations $\theta_i \sim i.i.d.U[0,1]$ and quasilinear preferences. Consider three different auction formats, in which all bidders submit bids simultaneously:
\begin{itemize}
	\item \emph{First-price sealed bid auction}, in which the highest bidder wins the item and pays their own bid. In such a format with $\theta_i \sim U[0,1]$, bidder $i$'s equilibrium bidding strategy is $b_i^{FPA} = \frac{N-1}{N} \theta_i$.
	\item \emph{Second-price sealed bid auction}, in which the highest bidder wins and pays the second-highest bid. In such a format, it is a weakly dominant strategy for bidder $i$ to bid their valuation: $b_i^{SPA} = \theta_i$.
	\item \emph{All-pay auction}, in which all bidders pay their bids, and the highest bidder wins the item. In such a format with $\theta_i \sim U[0,1]$, bidder $i$'s equilibrium bidding strategy is $b_i^{APA} = \frac{N-1}{N} \theta_i^N$.
\end{itemize}
Calculate the bidders' (interim) expected payoffs and the auctioneer's (ex ante) expected revenues under the three formats. Verify that they are the same across the three cases.

\emph{Bonus question:} verify that the bidding functions given for FPA and APA do indeed constitute an equilibrium.

\ifsolutions
\section*{Solution}

We use the following notation conventions, given some player $i$:
\begin{align*}
	K_i(\theta_i) &\equiv \mathbb{E}_{\theta_{-i}} \left[ k_i(\theta_i,\theta_{-i}) \right],
	\\
	T_i(\theta_i) &\equiv \mathbb{E}_{\theta_{-i}} \left[ t_i(\theta_i,\theta_{-i}) \right],
	\\
	\bar{U}_i(\theta_i) &\equiv \mathbb{E}_{\theta_{-i}} \left[ \theta_i K_i(\theta_i) - T_i(\theta_i) \right],
	\\
	\theta_{(2)} &\equiv \max_{j \in \{1,...,N\} \backslash \{i\}} \theta_j .
\end{align*}
(The $\theta_{(2)}$ is a somewhat weird notation, since its value depends on both the $i$'s identity and the type profile $\theta$, neither of which is reflected in the notation -- which should be more like $\theta_{(2),i}(\theta)$ or $\theta_{(2)}(\theta_{-i})$. Both of the latter options feel quite heavy though, hence we use simply $\theta_{(2)}$.)

Further, it will prove useful to derive the distribution of $\max_{i \in \{1,...,N\}} \theta_i$. Its cdf is given by $F_N(x)$ such that
\begin{equation} \label{eq:auc_Fmax}
\begin{aligned}
	F_{N}(x) 
	&= \mathbb{P} \left\{ \max_{i \in \{1,...,N\}} \theta_i \leq x \right\}
	\\
	&= \prod_{j \in \{1,...,N\}} \mathbb{P} \left\{ \theta_j \leq x \right\}
	\\
	&= x^N,
\end{aligned}
\end{equation}
where the second equality follows from the independence of players' valuations, and the final equality uses $\theta_j \sim U[0,1]$. The respective pdf is then given by $\phi_{N}(x) = Nx^{N-1}$.

\paragraph{FPA.} 
Given the proposed bidding strategy, the highest-valuation player wins the item. Bidder $i$'s interim expected payoff is
\begin{align*}
	\bar{U}_i(\theta_i) &= \mathbb{E}_{\theta_{-i}} \left[ \left( \theta_i - \frac{N-1}{N} \theta_i \right) \cdot \mathbb{I} \left\{ \theta_i > \theta_j, \forall j \neq i \right\} \right]
	\\
	&= \mathbb{E}_{\theta_{-i}} \left[ \frac{\theta_i}{N} \cdot \mathbb{I} \left\{ \theta_i > \theta_j, \forall j \neq i \right\} \right]
	\\
	&= \frac{\theta_i}{N} \cdot \mathbb{E}_{\theta_{-i}} \left[ \mathbb{I} \left\{ \theta_i > \theta_{(2)} \right\} \right]
\end{align*}
where the third inequality follows from the definition of $\theta_{(2)}$ and from $\frac{\theta_i}{N}$ being independent of $\theta_{-i}$. Then since $\theta_i$ is fixed, and the expectation of an indicator of an event is simply the probability of this event, we get
\begin{align*}
	\bar{U}_i(\theta_i) 
	&= \frac{\theta_i}{N} \cdot \mathbb{P} \left\{ \theta_{(2)} < \theta_i \right\}
	= \frac{\theta_i}{N} \cdot F_{N-1} (\theta_i)
	= \frac{\theta_i}{N} \cdot \theta_i^{N-1}
	= \frac{\theta_i^N}{N}.
\end{align*}
To show that the suggested strategy indeed constitutes an equilibrium, take some bidder $i$, suppose all other players bid according to $b_j(\theta_j) = \frac{N-1}{N} \theta_j$, and maximize $i$'s interim expected utility w.r.t. their bid $b_i$:
\begin{align*}
	\bar{U}_i(b_i,\theta_i) &= \mathbb{E}_{\theta_{-i}} \left[ \left( \theta_i - b_i \right) \cdot \mathbb{I} \left\{ b_i > \frac{N-1}{N} \theta_j, \forall j \neq i \right\} \right]
	\\
	&= (\theta_i - b_i) \cdot F_{N-1} \left(\frac{N b_i}{N-1} \right) = (\theta_i - b_i) \cdot \left(\frac{N b_i}{N-1} \right)^{N-1}.
\end{align*}
Taking the FOC of the maximization problem and solving it for $b_i$, we get
\begin{align*}
	\frac{d \bar{U}_i(b_i,\theta_i)}{db_i} 
	&= \left(\frac{N}{N-1} \right)^{N-1} \left[(N-1) \theta_i b_i^{N-2} - N b_i^{N-1} \right] = 0
	\\ \Rightarrow
	b_i^* &= \frac{N-1}{N} \theta_i,
\end{align*}
as conjectured.

Moving on to the designer's profit, 
\begin{align*}
	\mathbb{E}_\theta [R] = - \mathbb{E}_\theta[t_0(\theta)]
	&= \mathbb{E}_\theta \left[ \sum_{i=1}^N t_i(\theta) \right]
	\\
	&= \mathbb{E}_\theta \left[ \max_{i \in \{1,...,N\}} b_i(\theta_i) \right]
	\\
	&= \mathbb{E}_\theta \left[ \max_{i \in \{1,...,N\}} \frac{N-1}{N} \theta_i \right]
	\\
	&= \frac{N-1}{N} \mathbb{E}_\theta \left[ \max_{i \in \{1,...,N\}} \theta_i \right]
	\\
	&= \frac{N-1}{N} \int_0^1 x \phi_{N} (x) dx
	\\
	&= \frac{N-1}{N} \int_0^1 N x^N dx
	\\
	&= \frac{N-1}{N+1}.
\end{align*}
In the end, in FPA, $\bar{U}_i(\theta_i) = \frac{\theta_i^N}{N}$ and $\mathbb{E}_\theta [R] = 
\frac{N-1}{N+1}$.


\paragraph*{APA}
Following the same logic,
\begin{align*}
	\bar{U}_i(\theta_i) &= \mathbb{E}_{\theta_{-i}} \left[ \theta_i \cdot \mathbb{I} \left\{ \theta_i > \theta_j, \forall j \neq i \right\} - \frac{N-1}{N} \theta_i^N \right]
	\\
	&= \theta_i \cdot \theta_i^{N-1} - \frac{N-1}{N} \theta_i^N
	= \frac{\theta_i^N}{N}.
\end{align*}
In the second equality above, the first term is obtained using the exact same calculations as for FPA, and the second term lacks the expectation because it does not depend on $\theta_{-i}$.

To verify that the proposed strategy is optimal, proceed as in FPA:
\begin{align*}
	\bar{U}_i(b_i,\theta_i) &= \mathbb{E}_{\theta_{-i}} \left[ \theta_i \cdot \mathbb{I} \left\{ b_i > \frac{N-1}{N} \theta_j^N, \forall j \neq i \right\} - b_i \right]
	\\
	&= \theta_i F_{N-1} \left( \left( \frac{ N b_i}{N-1} \right)^\frac{1}{N} \right) - b_i
	\\
	&= \theta_i \left( \frac{ N b_i}{N-1} \right)^\frac{N-1}{N} - b_i
	\\ \Rightarrow
	\frac{d \bar{U}_i(b_i,\theta_i)}{db_i} 
	&= \theta_i \left( \frac{ N }{N-1} \right)^\frac{-1}{N} b_i^\frac{-1}{N} - 1 = 0
	\\ \Rightarrow
	b_i^* &= \frac{N-1}{N} \theta_i^N,
\end{align*}
as conjectured.
%TODO

For the designer's expected revenue,
\begin{align*}
	\mathbb{E}_\theta [R]
	&= \mathbb{E}_\theta \left[ \sum_{i=1}^N t_i(\theta) \right]
	\\
	&= \mathbb{E}_\theta \left[ \sum_{i=1}^N \frac{N-1}{N} \theta_i^N \right]
	\\
	&= \sum_{i=1}^N \frac{N-1}{N} \mathbb{E}_{\theta_i} \left[ \theta_i^N \right]
	\\
	&= (N-1) \int_0^1 x^N dx
	\\
	&= \frac{N-1}{N+1}.
\end{align*}
The third inequality above splits the expectation of the sum into the sum of expectations (using the linearity of the expectation operator) and notices that the expectation of $\theta_i^N$ only depends on the realization of $\theta_i$, but not on any of the other $\theta_j$. The fourth equality collapses the sum (since all the expectations are equal, due to symmetric distribution of valuations) and rewrites the expectation explicitly (with the pdf of $\theta_i$ being $\phi(x)=1$ for $x \in [0,1]$).


\paragraph*{SPA}
Interim expected utility for the bidder:
\begin{align*}
	\bar{U}_i(\theta_i) &= \mathbb{E}_{\theta_{-i}} \left[ \left( \theta_i - \theta_{(2)} \right) \cdot \mathbb{I} \left\{ \theta_i > \theta_j, \forall j \neq i \right\} \right]
	\\
	&= \theta_i \cdot \theta_i^{N-1} - \mathbb{E}_{\theta_{-i}} \left[ \theta_{(2)} \cdot \mathbb{I} \left\{ \theta_i > \theta_j, \forall j \neq i \right\} \right]
	\\
	&= \theta_i^N - \mathbb{E}_{\theta_{(2)}} \left[ \theta_{(2)} \cdot \mathbb{I} \left\{ \theta_{(2)} < \theta_i \right\} \right]
	\\
	&= \theta_i^N - \int_0^1 \left[ x \cdot \mathbb{I} \left\{ x < \theta_i \right\} \right] (N-1)x^{N-2} dx
	\\
	&=\theta_i^N - (N-1) \int_0^{\theta_i} x^{N-1} dx
	\\
	&=\theta_i^N - \frac{N-1}{N} \theta_i^N = \frac{\theta_i^N}{N}.
\end{align*}
In the above, the second equality uses the same calculation as FPA for the first term. All other manipulations concern the second term. The third equality notices that out of all information about all $\theta_{-i}$, only $\theta_{(2)}$ is relevant. The fourth equality writes the expectation down explicitly, using the distribution obtained in \eqref{eq:auc_Fmax}. The remainder is just algebra.

The expected revenue of the designer is given by:
\begin{align*}
	\mathbb{E}_\theta [R]
	&= \mathbb{E}_\theta \left[ \sum_{i=1}^N t_i(\theta) \right]
	\\
	&= \mathbb{E}_\theta \left[ \theta_{(2)} \right].
\end{align*}
However, the meaning of $\theta_{(2)}$ is different here, which should ideally be reflected in the notation but isn't. In the previous cases, when we took $\theta_i$ as fixed and took expectation over $\theta_{-i}$, it was the case that simply $\theta_{(2)} = \max_{j \in \{1,...,N\} \backslash \{i\}} \theta_j$, i.e., it was the highest valuation among $N-1$ bidders. Now, though, we need to genuinely calculate the \emph{second-highest bid among $N$ bidders}. We can derive its pdf $\phi_{(2)}(x)$ as the probability, for any $x$, that exactly $N-2$ valuations are below $x$, one valuation is at $x$, and one valuation is above $x$. Since the latter two can belong to any bidder, there are a total of $N(N-1)$ permutations. In the end:
\begin{align*}
	\phi_{(2)}(x) &= N (N-1) \cdot x^{N-2} \cdot 1 \cdot (1-x)
	\\ \Rightarrow 
	\mathbb{E}_\theta [R] = \mathbb{E}_\theta \left[ \theta_{(2)} \right]
	&= \int_0^1 x N(N-1) x^{N-2} (1-x) dx
	\\
	&= N(N-1) \left[ \int_0^1 x^{N-1} dx - \int_0^1 x^N dx \right]
	\\
	&= N(N-1) \left[\frac{1}{N} - \frac{1}{N+1}\right]
	\\
	&= N(N-1) \frac{1}{N(N+1)} = \frac{N-1}{N+2}.
\end{align*}

Hence we see that bidders' interim expected utilities and the designer's expected revenue are indeed the same across all three formats.
%\mathbb{E}_{\theta_{-i}} \left[  \right]
\fi 



\section{Efficient public good provision (continued)}

Consider problem 1 from the previous problem set.

Assume now that players' valuations are distributed according to $\theta_i \sim U[-\hat{\theta},\hat{\theta}]$ for all $i$, and that the public project has some known social cost $c > 0$.

Derive the gVCG transfers.

\ifsolutions
\section*{Solution}
LCT for any $i$ is $\tilde{\theta}_i = -\hat{\theta}$ (you do not actually need to calculate the expectation to find it, since the expression that $\tilde{\theta}_i$ minimizes is weakly monotone in $\theta_i$ -- i.e., one of the edges of the support is the solution). The gVCG transfers are then given by
\begin{align*}
	t_i^{gVCG}(\theta) &= \max \left\{0, \sum_{j\neq i}\theta_j -\hat{\theta} - c \right\} - \left(\sum_{j\neq i}\theta_j -c\right) \cdot \mathbb{I} \left\{ \sum_{j=1}^N \theta_j - c > 0 \right\}
	\\
	&= \begin{cases}
		0	&	\text{ if } \sum_{j=1}^N \theta_j - c \leq 0,
		\\
		-\left(\sum_{j\neq i}\theta_j - c \right)	&	\text{ if }	\sum_{j\neq i} \theta_j - \hat{\theta} - c \leq 0 < \sum_{j=1}^N \theta_j - c,
		\\
		-\hat{\theta}	&	\text{ if } \sum_{j\neq i}\theta_j -\hat{\theta} - c > 0.
	\end{cases}
\end{align*}
\fi



\section{Myerson-Satterthwaite theorem}

	Derive the gVCG transfers for the bilateral trade problem (assuming $\theta_b,\theta_s \sim U[0,1]$ and are mutually independent). Show that the resulting mechanism is not ex ante budget balanced (not even weakly).

\ifsolutions
\section*{Solution}

	The seller's valuation for the item is given by his private type $\theta_S \sim U[0,1]$, and the buyer's valuation is given by his private type $\theta_B \sim U[0,1]$. The outside options are given by $\underline{U}_S({\theta}_S)={\theta}_S$ and $\underline{U}_B({\theta}_B)=0$ respectively. The utilities of the two players are Euclidean and are given by:
	\begin{align*}
		u_S &= v(k,\theta_S)-t_S(\theta)=\theta_S (1-k)-t_S(\theta)
		\\
		u_B &= v(k,\theta_B)-t_B(\theta)=\theta_B k-t_B(\theta)
	\end{align*}
	where $k(\theta) \in [0,1]$ is the probability of trade given type profile $\theta$. It is straight-forward to see that the efficient allocation, $k^*$, is given by:
	\begin{align*}
		k^*= \begin{cases}
			1 & \text{ if } \theta_S \leq \theta_B \\ 
			0 & \text{ if } \theta_S > \theta_B
		\end{cases}
	\end{align*}
	Our next step is to construct the gVCG transfers that implement the efficient allocation. They are given by:
	\begin{align*}
		t_S^{gVCG} = v_B(k^*(\tilde{\theta}_S,\theta_B),\theta_B) + v_S(k^*(\tilde{\theta}_S,\theta_B),\tilde{\theta}_S) - \\
		-v_B(k^*(\theta_S,\theta_B),\theta_B) - \underline{U}_S(\tilde{\theta}_S)
		\\
		t_B^{gVCG} = v_S(k^*(\tilde{\theta}_B,\theta_S),\theta_S) + v_B(k^*(\tilde{\theta}_B,\theta_S),\tilde{\theta}_B) - \\
		-v_S(k^*(\theta_B,\theta_S),\theta_S) - \underline{U}_B(\tilde{\theta}_B)
	\end{align*}
	Noticing that the first two terms reduce to $v_B(k^*(\theta))+v_S(k^*(\theta)) = \max \{\theta_B,\theta_S\}$ (for some type profiles) and plugging in the efficient allocation $k^*$ and the outside options $\underline{U}_i$, we get
	\begin{align*}
		t_S^{gVCG} &= \max\{\tilde{\theta}_S,\theta_B\} - \theta_B k^*(\theta_S,\theta_B) - \tilde{\theta}_S
		\\
		t_B^{gVCG} &= \max\{\tilde{\theta}_B,\theta_S\} - \theta_S \left(1 - k^*(\theta_S,\theta_B)\right)
	\end{align*}
	
	The least charitable types $\tilde{\theta}_i$ of each player are defined as:
	\begin{align*}
		\tilde{\theta}_i &\in \arg \min_{\theta_i \in \Theta_i} \left\{ \mathbb{E}_{\theta_{-i}} \left[ v_B (k^*(\theta_i,\theta_{-i}),\theta_j) + v_S (k^*(\theta_i,\theta_{-i}),\theta_j) - \underline{U}_i (\theta_i) \right] \right\}
		\\
		\Rightarrow \tilde{\theta}_B &\in \arg \min_{\theta_B \in [0,1]} \left\{ \mathbb{E}_{\theta_S} \left[ \max\{\theta_B,\theta_S\} \right] \right\} 
		= \arg \min_{\theta_B \in [0,1]} \left\{ \int_0^1 \max\{\theta_B,\theta_S\} \phi(\theta_S) d\theta_S \right\}
		\\
		&= \arg \min_{\theta_B \in [0,1]} \left\{ \int_0^{\theta_B} \theta_B d\theta_S + \int_{\theta_B}^1 \theta_S d\theta_S \right\}
		= \arg \min_{\theta_B \in [0,1]} \left\{ \theta_B^2 +  \frac{1-\theta_B^2}{2} \right\}	
		\\
		&= \{ 0 \};
		\\
		\tilde{\theta}_S &\in \arg \min_{\theta_S \in [0,1]} \left\{ \mathbb{E}_{\theta_B} \left[ \max\{\theta_B,\theta_S\} - \theta_S \right] \right\} = \arg \min_{\theta_S \in [0,1]} \left\{ \frac{1}{2} + \frac{\theta_S^2}{2} - \theta_S \right\} = \{1\}.
	\end{align*}
	So in the end we have $\tilde{\theta}_B = 0$, $\tilde{\theta}_S = 1$. Plugging these into the respective expressions for transfers, we get the following (because $\max\{\tilde{\theta}_S,\theta_B\} = \max\{1,\theta_B\} = 1$, and $\max\{\tilde{\theta}_B,\theta_S\} = \max\{0,\theta_S\} = \theta_S$):
	\begin{align*}
		t_S^{gVCG} &= - \theta_B k^*(\theta_S,\theta_B)
		\\
		t_B^{gVCG} &= \theta_S k^*(\theta_S,\theta_B)
	\end{align*}
	Recall that BB (budget balance) is defined as $t_S+t_B\geq0$. The sum of gVCG transfers is:
	\begin{align*}
		t_S+t_B= \begin{cases}
			\theta_S - \theta_B <0 & \text{ if } \theta_S \leq \theta_B, 
			\\ 
			0 & \text{ if } \theta_S > \theta_B.
		\end{cases}
	\end{align*}
	Hence, we have now shown that the gVCG mechanism is not budget balanced (ex ante or ex post). However, it is the mechanism that yields the highest expected revenue $\mathbb{E}_\theta \left(t_S(\theta) + t_B(\theta)\right)$ among all mechanisms that are efficient, BIC, and interim IR. Therefore, there does not exist a mechanism for the bilateral trade problem which is efficient, BIC, interim IR, and ex ante BB.

\fi
	


\section{Auction with non-trivial seller valuation}
%Note: zero o.o. for seller confuses students. This is on purpose.
%Note: there is a clash of notation, with vj denoting valuations and not real utilities as in lectures.
	A seller, $i=1$, possesses a single indivisible object for which there are two potential buyers. Each buyer $i \in \{2,3\}$ has value $v_i$ for the good and the seller has an opportunity cost $c$ from selling the good.  Utility is quasi-linear in money, so if buyer $i$ purchases the good at price $p$, his final utility is $v_i-p$, and the seller's utility is $p-c$. Each agent has zero utility if he does not trade and zero is therefore also the reservation utility of each agent.
	
	Each $v_i$ is drawn independently from the same distribution $F$ which has full support on $[0,\bar v]$, and $c$ is drawn independently from a distribution $G$ which has support $[0,\bar c]$.  Assume that $F$ and $G$ satisfy all of the conditions necessary for the revenue
	equivalence theorem and our characterization results in class.
	
	\medskip
	A mechanism consists of two collections of functions, $q(c, v_2, v_3)$ and $t(c, v_2, v_3)$, where $q(c, v_2, v_3)$ is a probability distribution that prescribes the probabilities that the good will be allocated to each of the three agents, and $t(c, v_2, v_3)$ gives the list of transfers paid by each of the three agents.
	Say that a mechanism is \emph{feasible} if it is Bayesian incentive compatible, interim individually rational, and ex ante exactly budget-balanced.
	%TODO: using Borgers' prop 3.6, can strengthen this back to ex post BB. This also makes more sense in the context of the problem formulation which implies the same prices for buyer and seller.
	
	\begin{enumerate}
		\item What is the efficient allocation rule?
		
		\item Assume $\bar c = \bar v$.  Show that there does not exist a feasible mechanism that implements the efficient allocation rule. \emph{Hint: use gVCG and its properties.}
		
		\item Now assume $\bar v > \bar c$.  Show that the following is a sufficient condition for the existence of a feasible mechanism that implements the efficient allocation rule:
		$$ \mathbb{E}(\min\{v_2, v_3\}) \geq \bar c. $$
		\item Again assume $\bar{v} > \bar{c}$, but now suppose that there are $N$ potential buyers with values drawn independently from $F$.  Prove that for any $F$ and $G$ there is a $\bar N$ such that whenever $N > \bar{N}$  there exists a feasible mechanism that
		implements the efficient allocation rule.
	\end{enumerate}
	
	
\ifsolutions
\section*{Solution}
	Note: this problem has not been brought in conformance with the notation we use in class (allocations are $q$ instead of $k$, valuations are $v_i$ instead of $\theta_i$, conflicting with our notation for real utilities $v_i(k,\theta_i)$, it mentions both prices $p$ and transfers $t$...) This adds an extra layer of complexity that tests your skills in parsing text and context, rather than notation.

	This solution uses the following notation: $a \vee b \equiv \max\{a,b\}$; $a \wedge b \equiv \min \{a,b\}$.
	\begin{enumerate}%[\label=(\alph{enumi})]
		\item The efficient allocations must satisfy
		\begin{align*}
			q(c, v_2, v_3) = 
			\begin{cases}
				(1,0,0) &\text{ if } c > v_2, v_3, \\
				(0,1,0) &\text{ if } v_2 > c,v_3, \\
				(0,0,1) &\text{ if } v_3 > c,v_2.
			\end{cases}
		\end{align*}
		Ties can be broken arbitrarily.
		
		\item Let's use the Krishna--Perry theorem. The least charitable types are $0$ for the buyers and $\bar{c}$ for the seller (see problem 3).\footnote{This problem is more complex due to two buyers instead of one, but the idea is the same. Further, while you cannot compute the expectation $\mathbb{E}_{\theta_{-i}} [\sum v_i(k^*(\theta),\theta_i)]$ in this problem -- since distributions $F$ and $G$ are not specified, -- you can still see that, e.g., when you try to compute B2's LCT $\tilde{v}_2 \in \arg \min_{v_2} \left\{ \mathbb{E}_{c,v_3} \left[ \max\{c,v_2,v_3\} \right] \right\}$ the expression inside the expectation is weakly decreasing in $v_2$ for all $c,v_3$, hence the whole expectation is also weakly decreasing, so it is minimized by $v_2 = 0$.} 
		The gVCG mechanism has the following transfers:
		%
		\begin{itemize}
			
			\item when no trade occurs, there are no transfers
			
			\item when trade occurs between the seller and buyer $i$, $i$ pays $v_{-i} \vee c$, the seller receives $v_i \wedge \bar{c}$, and $-i$ has transfer zero.
			%\footnote{This solution uses the following notation: $a \vee b \equiv \max \{a,b\}$ and $a \wedge b \equiv \min \{a,b\}$.}
			
		\end{itemize}
		
		%When $c=0$ and $v_i > v_{-i}$, trade occurs, with the buyer paying $v_{-i} < \bar{v} =\bar{c}$ and the seller receiving $\bar{c}$. So there is a budget deficit.
		If $\bar{v}=\bar{c}$ then $v_i \wedge \bar{c} = v_i$, so this mechanism yields weakly negative revenue: %assuming wlog that $v_i > v_{-i}$, we get
		\begin{align*}
			\sum_i t_i (\theta) = \begin{cases}
				0 &\text{ if } c > v_2, v_3 \\
				v_3 \vee c - v_2 < 0 &\text{ if } v_2 > c,v_3 \\
				v_2 \vee c - v_3 < 0 &\text{ if } v_3 > c,v_2.
			\end{cases}
		\end{align*}
		
		Since gVCG mechanism has maximal revenue among efficient, BIC and IIR mechanisms, this implies that any other mechanism that is efficient, BIC, and interim IR will run an expected deficit. If there is no ex ante BB mechanism then there is no ex post BB mechanism either (deficit in expectation means that there must be deficit for at least some type realizations). Therefore, no feasible mechanism exists in this case.
		
		
		\item Let's use the same mechanism. The budget surplus is zero conditional on no trade, and
		%
		\begin{equation*}
			[ v_2 \wedge v_3 ] \vee c - [ v_2 \vee v_3 ] \wedge \bar{c}
			\geq [ v_2 \wedge v_3 ] - \bar{c} 
		\end{equation*}
		%
		conditional on trade. So the expected budget surplus is bounded below by
		%
		\begin{equation*}
			\mathbb{E}( [ v_2 \wedge v_3 ] - \bar{c} | v_2 \vee v_3 \geq c )
			\geq \mathbb{E}( [ v_2 \wedge v_3 ] - \bar{c} )
			\geq 0 .
		\end{equation*}
		
		So the gVCG mechanism runs an expected budget surplus, and we can make the mechanism exactly ex ante budget balanced by distributing the expected revenue among players.
		
		
		\item By analogous reasoning, the expected budget surplus is bounded below by
		\begin{equation*}
			\mathbb{E}\left( v^{(2)} - \bar{c} \right),
		\end{equation*}
		where $v^{(2)}$ is the second order statistic (the second-highest value). Since $v \in (\bar{c},\bar{v})$ with positive probability under $F$, the expected value $\mathbb{E} v^{(2)}$ can be made arbitrarily close to $\bar{v}$ by taking $N$ large enough; in particular, $N$ can be chosen large enough to make it higher than $\bar{c}$.
	\end{enumerate}
\fi




%%-----------------------------------------------------------------------------------------------------

\end{document}
