%%% License: Creative Commons Attribution Share Alike 4.0 (see https://creativecommons.org/licenses/by-sa/4.0/)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[a4paper]{article}

\usepackage{amssymb}
\usepackage{enumitem}
\usepackage[usenames,dvipsnames]{color}
\usepackage{fancyhdr} % Required for custom headers
\usepackage{lastpage} % Required to determine the last page for the footer
\usepackage{extramarks} % Required for headers and footers
\usepackage[usenames,dvipsnames]{color} % Required for custom colors
\usepackage{graphicx} % Required to insert images
\usepackage{listings} % Required for insertion of code
\usepackage{courier} % Required for the courier font
\usepackage[table]{xcolor}
\usepackage{amsfonts,amsmath,amsthm,parskip,setspace,url}
\usepackage[section]{placeins}
\usepackage[a4paper]{geometry}
\usepackage[USenglish]{babel}
\usepackage[utf8]{inputenc}
\usepackage{tikz}


% Margins
\topmargin=-0.45in
\evensidemargin=0in
\oddsidemargin=0in
\textwidth=6.5in
\textheight=9.0in
\headsep=0.6in

\linespread{1.1} % Line spacing



%----------------------------------------------------------------------------------------
%   FORMATTING
%----------------------------------------------------------------------------------------
% Set up the header and footer
\pagestyle{fancy}
\lhead[c]{\textbf{{\color[rgb]{.5,0,0} K{\o}benhavns\\Universitet }}} % Top left header
\chead{\textbf{{\color[rgb]{.5,0,0} \Class }}\\ \hmwkTitle  } % Top center head
\rhead{\instructor \\ \theprofessor} % Top right header
\lfoot{\lastxmark} % Bottom left footer
\cfoot{} % Bottom center footer
\rfoot{Page\ \thepage\ of\ \protect\pageref{LastPage}} % Bottom right footer
\renewcommand\headrulewidth{0.4pt} % Size of the header rule
\renewcommand\footrulewidth{0.4pt} % Size of the footer rule


% Other formatting stuff
%\setlength\parindent{12pt}
\setlength{\parskip}{5 pt}
%\theoremstyle{definition} \newtheorem{ex}{\textbf{\Large{Exercise & #}\\}}
\usepackage{titlesec}
\titleformat{\section}[hang]{\normalfont\bfseries\Large}{Problem \thesection:}{0.5em}{}




%----------------------------------------------------------------------------------------
%	NAME AND CLASS SECTION
%----------------------------------------------------------------------------------------
\newcommand{\hmwkTitle}{Exercises after Lecture 10 (M5)} % Assignment title
\newcommand{\Class}{Mechanism Design} % Course/class
\newcommand{\instructor}{Fall 2021} % TA
\newcommand{\theprofessor}{Prof. Egor Starkov} % Professor




%----------------------------------------------------------------------------------------
%   SOLUTIONS
%----------------------------------------------------------------------------------------
\newif\ifsolutions
%\solutionstrue




\begin{document}

\begin{center}
		\LARGE\textbf{Exercises after Lecture 10 (M5):\\ Dynamic mechanisms.}
\end{center}



\section{Dynamic Efficient Allocation}
	Consider a dynamic problem of efficient allocation. The designer has one indivisible item that he seeks to allocate across two periods, $t=1,2$. There are four players, $i\in \{a,b,c,d\}$. Players $i=a,b$ are in the market only during period $t=1$; players $i=c,d$ are in the market only during period $t=2$. In a given period, the designer can only interact with players who are in the market at that period. 
	
	All players have private valuations $\theta_i \sim \text{i.i.d.}U[0,1]$ for the item and Euclidean preferences $u_i(k,p,\theta) = \theta_i k_i - p$, where $k_i$ is the probability $i$ gets the item and $p$ is the payment $i$ makes.
	
	The designer's goal is to allocate the item efficiently, i.e., to the player with the highest valuation $\theta_i$. The designer discounts future payoffs using discount factor $\delta \leq 1$. In other words, the designer maximizes the expected discounted social surplus resulting from the allocation and does not care about monetary cost or profit (or the players' participation constraints).
	
	\begin{enumerate}
		\item Suppose the item was not allocated in period $t=1$, i.e., the designer still has the item in his possession at the beginning of $t=2$. Propose a (static) mechanism that the designer can use to allocate the item efficiently among players $i=c,d$ at $t=2$. Describe your mechanism \emph{completely} and argue that it is incentive compatible (DSIC or BIC).
		\item Moving on to $t=1$. The designer faces a choice between giving the item to one of the players $i=a,b$ or keeping it until $t=2$. 
		Compute the expected social surplus from the latter decision (keeping the item until $t=2$), assuming that your mechanism from part 1 is used at $t=2$.
		\item Describe the efficient dynamic allocation rule $\kappa^* = (k^*_1(\theta_a,\theta_b), k^*_2(\theta_c,\theta_d))$.
		\item Propose a full dynamic mechanism that implements the efficient allocation rule $\kappa^*$ in both periods. Describe your mechanism completely. (\emph{Hint: in Part 1 you have already found how the mechanism should look like for $t=2$, now you need to complete it for $t=1$. While you can use the Dynamic Pivot Mechanism, there exists a simpler way.})
	\end{enumerate}
	
	
\ifsolutions
\section*{Solution}
	Note: there is flexibility in how to describe outcomes $(k_t,p_t)$ for a given period. One can specify outcomes for all players, e.g., $k_t = (k_{a,t},k_{b,t},k_{c,t},k_{d,t})$ for allocations and similarly for payments, or only for players that are currently present, e.g., $k_1 = (k_{a,t},k_{b,t})$ and $k_2 = (k_{c,t},k_{d,t})$. In this particular problem, both options are acceptable; the solution below adopts the latter convention.
	\begin{enumerate}
		\item In this static problem, the efficient allocation should give the item to the player with the highest valuation:
		\begin{align*}
			k^*_2 = (k^*_{c,2},k^*_{d,2}) = 
			\begin{cases}
				(1,0) & \text{ if } \theta_c \geq \theta_d,
				\\
				(0,1) & \text{ if } \theta_c \leq \theta_d.
			\end{cases}
		\end{align*}
		(The tie can be broken arbitrarily.)
		
		The best way to implement this efficient allocation $k^*_2$ is to use the VCG/pivot mechanism $(k^*_2,p^{VCG}_2)$, where the payments are given by (using notation from lectures)
		\begin{align*}
			p^{VCG}_{i,2} (\theta) &= -\left(\sum_{j\neq i}  v_{j}(k^*_2(\theta), \theta_{j}) \right) + \sum_{j\neq i} v_{j}(k^{-i}_2(\theta_{-i}), \theta_{j})
			\\
			&= - \theta_j \cdot \mathbb{I} \{ k^*_{j,2} (\theta) = 1 \} + \theta_j \cdot \mathbb{I} \{ k^{-i}_{j,2} (\theta) = 1 \}
			\\
			&= -\theta_j \cdot \mathbb{I} \{ \theta_i \geq \theta_j \},
		\end{align*}
		where $i,j \in \{c,d\}$, $j\neq i$, $\mathbb{I} \{\cdot\}$ is the indicator function, and $k^{-i}_2$ is the efficient allocation that ignores player $i$ (i.e., in this problem $k^{-i}_2$ prescribes the item to be given to $j$ for all $\theta=(\theta_c,\theta_d)$). As we know from lectures, VCG is DSIC.
		
		Using generalized VCG would yield the same answer as above. You could also use AGV/expected externality mechanism, which uses transfers $p^{AGV}_{i,2} (\theta) = \frac{1}{2} \left[ \theta_i^2 - \theta_j^2 \right]$, but it would only be BIC.
		
		The ``complete description of the mechanism'' means the following:
		\begin{itemize}
			\item you can use off-the-shelf mechanisms ([g]VCG or AGV), in which case you must  describe both the [efficient] allocation rule $k^*$ and the payment rule $p$ used by the mechanism. Proof of incentive compatibility is not required in this case. NOTE: simply using Groves' transfers and leaving $h_i(\theta_{-i})$ unspecified does not count as a complete description.
			
			\item If you do not use one of the aforementioned mechanisms, you should describe explicitly what is the set of actions available to the players (i.e., what they should do in or report to the mechanism) or mention that the proposed mechanism is direct. You should then specify allocation and payment rules $(k,p)$ used in their mechanism as respective functions of players' reports or actions. (Allocation rule $k$ must coincide with the efficient $k^*$.) You should then prove that their mechanism is incentive compatible in DSIC or BIC sense.
		\end{itemize}
		
		\item Allocating the item efficiently in period $t=2$ generates surplus $S_2 = \max \{\theta_c,\theta_d\}$. Since $\theta_c,\theta_d \sim \text{i.i.d.}U[0,1]$, the expected surplus as evaluated at $t=1$ is $\delta \cdot \mathbb{E} S_2 = \frac{2\delta}{3}$. 
		
		\item The efficient allocation rule at $t=2$ if the item was not allocated at $t=1$ was described in part 1. The efficient rule at $t=2$ if the item was already allocated is trivial ($k^*_{2,i} = 0$ for $i \in \{c,d\}$). We are left to describe $k^*_1$.
		
		Note that valuations of players $i=c,d$ are not known to anyone at $t=1$, hence ex post efficiency is unattainable, and interim efficiency is the most we can achieve. The expected value from not allocating the item at $t=1$ is given by $\frac{2\delta}{3}$, as computed in part 2. The efficient allocation is thus
		\begin{align*}
			k^*_1 = (k^*_{a,1},k^*_{b,1}) = 
			\begin{cases}
				(1,0) & \text{ if } \theta_a \geq \max\{\theta_b, \frac{2\delta}{3}\},
				\\
				(0,1) & \text{ if } \theta_b \geq \max\{\theta_a, \frac{2\delta}{3}\},
				\\
				(0,0) & \text{ otherwise}.
			\end{cases}
		\end{align*}
		
		\item \textbf{Option 1.} The non-trivial part of the problem for $t=2$ was solved in part 1. The problem at $t=1$ is effectively that of allocating the item between three players with respective valuations $(\theta_1, \theta_2, \frac{2\delta}{3})$. Therefore, the smart way to solve it then is to simply employ VCG or AGV again, using the shadow player with valuation $\frac{2\delta}{3}$ to represent the designer's option to retain the item (or just assuming directly that the designer's value for the item is $\frac{2\delta}{3}$). The respective payments for $i,j \in \{a,b\}$, $j\neq i$ are given by
		\begin{align*}
			p^{VCG}_{i,1} (\theta) &= -\max \left\{\theta_j, \frac{2\delta}{3}\right\} \cdot \mathbb{I} \left\{ \theta_i \geq \max \left\{\theta_j, \frac{2\delta}{3}\right\} \right\},
			\\
			p^{AGV}_{i,1} (\theta) &= \frac{1}{2} \left[ \left(\max \left\{\theta_i, \frac{2\delta}{3}\right\}\right)^2 - \left(\max \left\{\theta_j, \frac{2\delta}{3}\right\}\right)^2 \right].
		\end{align*}
	
		\textbf{Option 2.} It is also possible to use the dynamic pivot mechanism here and obtain VCG payments from flow marginal contributions. Applying the analysis for $t=2$, we get that flow social surplus and total welfare in period $2$ are $w_2(k_2,\theta_1,\theta_2) = k_{c,2} \theta_c + k_{d,2} \theta_d$ and $W_2(\theta_1,\theta_2,k_1) = (1-(k_{a,1}+k_{b,1})) \max \{\theta_c,\theta_d\}$. In period $1$, the flow surplus is $w_1(k_1,\theta_1) = k_{a,1} \theta_a + k_{b,1} \theta_b$. The total welfare is then 
		\begin{align*}
			W_1(\theta_1) &= \max_k \left\{ k_{a,1} \theta_a + k_{b,1} \theta_b + \delta \mathbb{E}_{\theta_2} \left[(1-k_{a,1}-k_{b,1}) \max \{\theta_c,\theta_d\} \right] \right\}
			\\
			&= \max \left\{ \theta_a, \theta_b, \delta \mathbb{E} \max \{\theta_c,\theta_d\} \right\}
			\\
			&= \max \left\{ \theta_a, \theta_b, \frac{2\delta}{3} \right\}.
		\end{align*}
		
		\textbf{Period-one players $(i=a,b)$.}
		Since players $i=a,b$ are only active in period $t=1$, welfare-excluding-them at $t=2$ is given by $W_{-i,2}(\theta_1,\theta_2) = W_2(\theta_1,\theta_2)$ and at $t=1$ by
		\begin{align*}
			W_{-i,1}(\theta_1) &= \max_k \left\{ k_{-i,1} \theta_{-i} + \delta \mathbb{E}_{\theta_2} \left[(1-k_{-i,1}) \max \{\theta_c,\theta_d\} \right] \right\}
			\\
			&= \max \left\{ \theta_{-i}, \frac{2\delta}{3} \right\}
		\end{align*}
		Then if $\theta_a > \theta_b$, the two players' marginal contributions at $t=1$ are $M_{b,1} = 0$ and
		\begin{equation*}
			M_{a,1} (\theta_1) = \begin{cases}
				\theta_a - \max\left\{ \theta_b, \frac{2\delta}{3} \right\} & \text{ if } \theta_a \geq \frac{2\delta}{3}
				\\
				0 & \text{ otherwise},
			\end{cases}
		\end{equation*}
		and vice versa if $\theta_a < \theta_b$ (break the tie arbitrarily). Given that both are only active at $t=1$, their marginal contributions at $t=2$ are $M_{a,2}(\theta_1,\theta_2) = M_{b,2}(\theta_1,\theta_2) = 0$, and so are their flow marginal contributions at $t=2$: $m_{i,2} (\theta_2, k_1) =0$. The fmc at $t=1$ are $m_{i,1} (\theta_1) = M_{i,1} (\theta_1)$ for $i=a,b$. Making the final step, the payments $p_{i,t}(\theta_t,K_t)=v_i(k_t^*,\theta_{i,t}) - m_{i,t}(\theta_t,K_t)$ prescribed by the dynamic pivot mechanism are then
		\begin{align*}
			p^{DPM}_{a,1} (\theta_1) = \begin{cases}
				\theta_a - \max \left\{ \theta_b, \frac{2\delta}{3} \right\} & \text{ if } \theta_a \geq \max \left\{ \theta_b, \frac{2\delta}{3} \right\}
				\\
				0 & \text{ otherwise},
			\end{cases}
		\end{align*}
		$p^{DPM}_{a,2} (\theta_1,\theta_2) = 0$, and analogously for player $b$.
		
		\textbf{Period-two players $(i=c,d)$.}
		Welfare-excluding-$i$ at $t=2$ is that from giving the item to the other current player: $W_{-i,2} (\theta_1,\theta_2,k_1) = (1-(k_{a,1}+k_{b,1})) \theta_{-i}$. At $t=1$, things are more complicated, since ignoring player $i \in \{c,d\}$ changes the designer's option value of retaining the good at $t=1$: if $k_1 = (0,0)$ then $W_2 = \theta_{-i}$, so $\delta \mathbb{E} W_2 = \frac{\delta}{2}$ (as opposed to $\frac{2\delta}{3}$ if $i$ is accounted for.) So we get that 
		\begin{align*}
			W_{-i,1}(\theta_1) &= \max_k \left\{ k_{a,1} \theta_a + k_{b,1} \theta_b + \delta \mathbb{E}_{\theta_2} \left[(1-k_{-i,1}) \max \{\theta_c,\theta_d\} \right] \right\}
			\\
			&= \max \left\{ \theta_a, \theta_b, \frac{\delta}{2} \right\}.
		\end{align*}
		Moving on to the marginal contributions for $i=c,d$, we then have at $t=2$ that if $\theta_c \geq \theta_d$: 
		\begin{align*}
			M_{c,2}(\theta_1,\theta_2) = m_{c,2}(\theta_1,\theta_2) &= (1-(k_{a,1}+k_{b,1}))(\theta_c - \theta_d)
			\\
			M_{d,2}(\theta_1,\theta_2) = m_{d,2}(\theta_1,\theta_2) &= 0,
		\end{align*}
		and vice versa. At $t=1$, on the other hand:
		\begin{align*} 
			M_{i,1} (\theta_1) &= W_1(\theta_1) - W_{-i,1}(\theta_1) = \max \left\{ \theta_a, \theta_b, \frac{2\delta}{3} \right\} -  \max \left\{ \theta_a, \theta_b, \frac{\delta}{2} \right\}
			\\
			\Rightarrow
			m_{i,1} (\theta_1) &= M_{i,1} (\theta_1) - \delta \mathbb{E} [M_{i,2}(\theta_1,\theta_2) ] 
			\\
			&= \max \left\{ \theta_a, \theta_b, \frac{2\delta}{3} \right\} -  \max \left\{ \theta_a, \theta_b, \frac{\delta}{2} \right\} - \delta \mathbb{E} \left[ (\max\{\theta_i,\theta_j\} - \theta_j) \cdot \mathbb{I}\left\{ \frac{2\delta}{3} \geq \max\{ \theta_a,\theta_b\} \right\} \right].
		\end{align*}
		Therefore, the payments prescribed by the dynamic pivot mechanism are, for $i,j=c,d$,
		\begin{align*}
			p^{DPM}_{i,2} (\theta_1,\theta_2) &= \begin{cases}
				\theta_j & \text{ if } \frac{2\delta}{3} \geq \max\{ \theta_a,\theta_b\} \text{ and } \theta_i > \theta_j,
				\\
				0 & \text{ otherwise};
			\end{cases}
		\end{align*}
		\begin{align*}
			p^{DPM}_{i,1} (\theta_1) &= -\max \left\{ \theta_a, \theta_b, \frac{2\delta}{3} \right\} + \max \left\{ \theta_a, \theta_b, \frac{\delta}{2} \right\} + \delta \mathbb{E} \left[ (\max\{\theta_i,\theta_j\} - \theta_j) \right] \cdot \mathbb{I}\left\{ \frac{2\delta}{3} \geq \max\{ \theta_a,\theta_b\} \right\}
			\\
			&= \begin{cases}
				\max \{\theta_a, \theta_b\} - \frac{\delta}{2} & \text{ if } \max \{\theta_a, \theta_b\} \in \left(\frac{\delta}{2}, \frac{2\delta}{3} \right),
				\\
				0 & \text{ otherwise.}
			\end{cases}
		\end{align*}
		Note that now players $c$ and $d$ may be asked to make a payment at $t=1$, which is the only difference of the DPM payments from the ``double SPA'' guess made in Option 1, but this payment does not depend on $\theta_c$ or $\theta_d$, hence does not affect their reporting incentives.
		
		\textbf{Options 1,2.} Regardless of the path taken above, you must fully describe the resulting dynamic mechanism, requirements same as in part 1. Example: ``in period 1, a direct mechanism $(k^*_1,p^{VCG}_1)$ is used, and if the item is not allocated then a VCG mechanism is used in period 2 that implements allocation $k^*_2$ using transfers $p^{VCG}_{2}$. Both periods use static VCG mechanisms for participating players, which (mechanisms) are incentive compatible in dominant strategies, as was shown in lectures''.
	\end{enumerate}
\fi



\section{Sales with changing valuations}
	%dynamic revenue maximization
	Consider a repeated sales problem. There are two periods, $t=1,2$. A single seller has one perishable item for sale in each period $t$ (i.e., he has exactly one item for sale at $t=2$ regardless of whether he sold the item at $t=1$). 
	
	A single buyer has evolving valuation per unit of product: her valuation at $t=1$ is given by $\theta_1 \sim U[0,1]$, and her valuation at $t=2$ is given by $\theta_2 = \theta_1 + \varepsilon$, where $\varepsilon$ is a zero-mean random variable independent of $\theta_1$ distributed according to c.d.f. $F_\varepsilon$.
	
	The buyer observes $\theta_1$ at the beginning of $t=1$ (before she decides whether to accept the seller's mechanism) and observes $\varepsilon$ at the beginning of $t=2$. The buyer has Euclidean preferences: at time $t$ her expected utility is given by
	\begin{equation*}
		u_{b,t} (k,p,\theta_t) = \sum_{s=t}^2 \mathbb{E} \left[ \theta_s k_s - p_s \mid \theta_t \right],
	\end{equation*}
	where $k_s$ is the probability with which the buyer receives the item in period $s$, and $p_s$ is the payment she makes at $s$ (not contingent on getting the item). In particular, the buyer does not discount the future (discount factor is $\delta=1$); suppose the same holds for the seller. Further, the buyer has valuation $\theta_2$ for an additional item at $t=2$ even if she already got one item at $t=1$.
	
	The seller chooses a mechanism $\{(k_t,p_t)\}_{t \in \{1,2\}}$ that maximizes the ex ante expected revenue $U_s = \mathbb{E} \left[ p_1 + p_2 \right]$. This mechanism should be incentive compatible and ensure that participation is optimal for the buyer (at $t=1$).
	
	\begin{enumerate}
		\item %(10pts) 
		Assume that $\varepsilon \equiv 0$, i.e., $\theta_2 = \theta_1$, and this is commonly known. Describe the optimal mechanism. (\emph{Hint: you do not need to know anything about dynamic mechanisms to do this.})
		\item %(10pts) 
		Assume that the seller can perfectly observe $\varepsilon$ at the beginning of $t=2$. Describe the optimal allocation rule.
		\item %(5pts) 
		Assume the same as in part 2 plus that $\varepsilon \sim U[-1,1]$. Find the interim (i.e., conditional on $\theta_1$) expected payment by the buyer in the optimal mechanism.
		\emph{(Hint: assume that the buyer pays some fixed amount $p_1$ if she gets the item at $t=1$ and amount $p_2(\theta_1)$ if she gets the item at $t=2$. Compute these amounts and take respective expectations.)}
	\end{enumerate}


\ifsolutions
\section*{Solution}
	\begin{enumerate}
		\item Note that this is equivalent to the static optimal mechanism problem from class. The solution here is a direct mechanism in which the buyer reports $\theta_1$ at $t=1$, reports nothing at $t=2$, and the outcome is given by
		\begin{align*}
			(k_1,k_2,p_1,p_2)(\theta_1) =
			\begin{cases}
				\left( 1,1, \frac{1}{2}, \frac{1}{2} \right) & \text{ if } \theta_1 \geq \frac{1}{2},
				\\
				\left( 0,0,0,0 \right) & \text{ if } \theta_1 < \frac{1}{2}.
			\end{cases}
		\end{align*}
		Note that payments $(p_1,p_2)$ can be arbitrary as long as $p_1(\theta_1) + p_2(\theta_1) = 1 \cdot \mathbb{I} \left\{ \theta_1 \geq \frac{1}{2} \right\}$.
		
		\item The impulse response function at $t=2$ is given by
		\begin{equation*}
			I_2(\theta_2 | \theta_1) = -\frac{\frac{\partial F_2(\theta_2 | \theta_1)}{\partial \theta_1}}{\phi_2(\theta_2 | \theta_1)} = -\frac{\frac{\partial F_\varepsilon(\theta_2 - \theta_1)}{\partial \theta_1}}{\frac{\partial F_\varepsilon(\theta_2 - \theta_1)}{\partial \theta_2}} = 1.
		\end{equation*}
		The seller's virtual surplus at $t=1$ (over both periods) is then
		\begin{align*}
			VS_1 (\theta_1) &= k_1(\theta_1) \cdot \left( \theta_1 - \frac{1-F_1(\theta_1)}{\phi_1(\theta_1)} \right) + \mathbb{E} \left[ k_2(\theta_1,\theta_2) \cdot \left( \theta_2 - I_2(\theta_2 | \theta_1) \frac{1-F_1(\theta_1)}{\phi_1(\theta_1)} \right) \right]
			\\
			&= k_1(\theta_1) \cdot \left( 2 \theta_1 - 1 \right) + \mathbb{E} \left[ k_2(\theta_1,\theta_2) \cdot \left( \theta_2 - (1 - \theta_1) \right) \right]
		\end{align*}
		Maximizing it over $(k_1,k_2)$, we get the optimal allocation rules\footnote{One could also use $VS_2(\theta_1,\theta_2)$ to find $k_2(\theta_1,\theta_2)$, and with that knowledge then proceed to finding $k_1(\theta_1)$ from $VS_1(\theta_1)$. This solution merges these two steps into one.}
		\begin{align*}
			k_2 (\theta_1,\theta_2) &= \mathbb{I} \left\{ \theta_1 + \theta_2 \geq 1 \right\};
			\\
			k_1 (\theta_1) &= \mathbb{I} \left\{ \theta_1 \geq \frac{1}{2} \right\}.
		\end{align*}
		
		\item To find transfers, use the envelope representation of the buyer's expected utility:
		\begin{align*}
			\frac{d U_{b,1} (\theta_1)}{d \theta_1} &= k_1(\theta_1) + \mathbb{E} \left[ I_2(\theta_2 | \theta_1) k_2(\theta_1,\theta_2) \mid \theta_1 \right]
			\\
			&= \mathbb{I} \left\{ \theta_1 \geq \frac{1}{2} \right\} + 1 - F_\varepsilon (1 - 2\theta_1)
			\\
			&= \mathbb{I} \left\{ \theta_1 \geq \frac{1}{2} \right\} + \theta_1
			\\
			\Rightarrow U_{b,1} (\theta_1) &= \left(\theta_1 - \frac{1}{2}\right)_+ + \frac{\theta_1^2}{2}.
		\end{align*}
		Note that the first term is the same as in the static mechanism, i.e., we can say that the consumer is presented with price $p_1 = \frac{1}{2}$ for the item at $t=1$. Then denoting the expected price that the consumer pays for the item in the second period as $p_2(\theta_1)$, we have the following representation of the expected utility:
		\begin{align*}
			U_{b,1} (\theta_1) &= \left(\theta_1 - \frac{1}{2}\right) \cdot k_1(\theta_1) + \mathbb{E}_{\theta_2} \left[ (\theta_2 - p_2(\theta_1)) \cdot k_2 (\theta_1,\theta_2) \mid \theta_1 \right]
			\\
			&=\left(\theta_1 - \frac{1}{2}\right)_+ + \mathbb{E} \left[ (\theta_1 + \varepsilon) \cdot \mathbb{I} \left\{\varepsilon \geq 1 - 2\theta_1 \right\} \right] - p_2(\theta_1) \cdot \left( 1 - F_\varepsilon(1-2\theta_1) \right)
			\\
			&= \left(\theta_1 - \frac{1}{2}\right)_+ + \theta_1 (1-\theta_1) + (\theta_1 - p_2(\theta_1)) \theta_1
		\end{align*}
		Combining the two expressions for $U_{b,1}(\theta_1)$, we obtain that $p_2(\theta_1) = 1 - \frac{\theta_1}{2}$. Therefore, the buyer's total interim expected payment is
		\begin{align*}
			p(\theta_1) &= \frac{1}{2} \cdot \mathbb{I}\left\{ \theta_1 \geq \frac{1}{2} \right\} + \left(1 - \frac{\theta_1}{2}\right)\cdot (1 - F_\varepsilon(1-2\theta_1))
			\\
			&= \frac{1}{2} \cdot \mathbb{I}\left\{ \theta_1 \geq \frac{1}{2} \right\} + \theta_1 - \frac{\theta_1^2}{2}.
		\end{align*}
	\end{enumerate}
\fi


\end{document}
